import{_ as k,c,o as d,a as s,b as g,F as m,r as w,t as f,n as b,d as v,e as I,E as x,f as C,U as p}from"./index-DQttHk2-.js";/* empty css                  *//* empty css                  *//* empty css                         */import{s as y}from"./supabase-iLmQ7oP8.js";const _={name:"MainPage",components:{},data(){return{bInitLoadFinish:!1,totalInscriptionCount:0,curPage:1,kMaxImageLen:160,kAudioNameLen:64,kAudioDescLen:64,kPageSize:25,gotoPage:"",tableData:[],asyncInfo:{id:0,kMaxInRequestCount:10,kMaxRetryTimes:10,retryTimes:0,bFailFlag:!1,curInRequestCount:0},bNonDSMode:!1,switchTip:"Request server error, you can switch to non dedicated server mode."}},async mounted(){try{this.bInitLoadFinish=!1;const{data:r,error:t,status:e}=await y.from("inscriptions").select("id, block, type, payload").order("id",{ascending:!1}).limit(this.kPageSize);e==200&&!t?(this.setTableData(r),this.tableData.length>0&&(this.totalInscriptionCount=this.tableData[0].id)):(console.log(`mounted req fail: status:${e}, error:${JSON.stringify(t)}`),p.alert(this.switchTip))}catch{p.alert(this.switchTip)}finally{this.bInitLoadFinish=!0}},methods:{setTableData(r){let t=[];this.tableData.splice(0,this.tableData.length);for(let e=0;e<r.length;e++){const o=r[e];let n={key:o.id,id:o.id,block:o.block,dataType:o.type,owner:"",payload:"",optInfo:{imageUrl:"",imageWidth:"",imageHeight:this.kMaxImageLen,originImageWidth:0,originImageHeight:0,text:"",audioName:"",audioDesc:"",audioUrl:""}};if(n.dataType=="text"||n.dataType=="deploy-stx10")n.payload=o.payload,n.optInfo.text=o.payload;else{const i=o.payload.split("_*|");i.length==3&&i[1].endsWith(`_${n.id}`)?t.push({index:e,inscData:n,syncUrl:i[1]}):console.log("setTableData error",i,n)}this.tableData.push(n)}this.syncTable(t)},async syncTable(r){if(!r||r.length==0)return;let t=this.asyncInfo.id+1;this.asyncInfo.id=t,this.asyncInfo.curInRequestCount=0,this.asyncInfo.retryTimes=0,this.asyncInfo.bFailFlag=!1;let e=0;for(;t==this.asyncInfo.id&&!this.asyncInfo.bFailFlag&&e<r.length;)this.asyncInfo.curInRequestCount<this.asyncInfo.kMaxInRequestCount?(++this.asyncInfo.curInRequestCount,this.syncOne(t,r[e++])):await new Promise(o=>setTimeout(o,1e3))},async syncOne(r,t){const e=t.inscData;let o=null,n=!1;for(;;){const l=localStorage.getItem(t.syncUrl);if(l){o=p.base64ToBlob(l,"text/plain");break}const{data:h,error:a}=await y.storage.from("payload").download(t.syncUrl);if(r!=this.asyncInfo.id)return;if(a){if(++this.asyncInfo.retryTimes>this.asyncInfo.kMaxRetryTimes){this.asyncInfo.bFailFlag=!0;return}await new Promise(u=>setTimeout(u,5e3))}o=h,n=!0;break}if(e.payload=o,e.dataType.startsWith("image/")){e.optInfo.imageUrl=window.URL.createObjectURL(new Blob([o],{type:e.dataType}));var i=new Image;i.src=e.optInfo.imageUrl;let l=this;i.onload=function(){e.optInfo.originImageWidth=i.width,e.optInfo.originImageHeight=i.height,i.width>i.height?(e.optInfo.imageWidth=l.kMaxImageLen,e.optInfo.imageHeight=Math.ceil(i.height*l.kMaxImageLen/i.width)):(e.optInfo.imageHeight=l.kMaxImageLen,e.optInfo.imageWidth=Math.ceil(i.width*l.kMaxImageLen/i.height)),e.key=e.key+1,l.$forceUpdate()}}else if(e.dataType.startsWith("audio/")){const l=new Uint8Array(await o.arrayBuffer()),h=l.slice(l.length-this.kAudioNameLen-this.kAudioDescLen,l.length-this.kAudioDescLen);e.optInfo.audioName=new TextDecoder().decode(h).trim();const a=l.slice(l.length-this.kAudioDescLen);e.optInfo.audioDesc=new TextDecoder().decode(a).trim();const u=l.slice(0,l.length-this.kAudioNameLen-this.kAudioDescLen);e.optInfo.audioUrl=window.URL.createObjectURL(new Blob([u],{type:e.dataType})),e.key=e.key+1,this.$forceUpdate()}n&&p.blobToBase64(o,function(l){try{localStorage.setItem(t.syncUrl,l)}catch(h){h.toString().includes("exceeded the quota")&&(console.log("exceeded the quota, purge"),localStorage.clear())}}),this.asyncInfo.curInRequestCount=Math.max(this.asyncInfo.curInRequestCount-1,0)},onClickChangePage(){this.loadCurrentPage()},async loadCurrentPage(){const r=this.totalInscriptionCount-(this.curPage-1)*this.kPageSize;try{const{data:t,error:e,status:o}=await y.from("inscriptions").select("id, block, type, payload").lte("id",r).order("id",{ascending:!1}).limit(this.kPageSize);o==200&&!e?this.setTableData(t):(console.log(`mounted req fail: status:${o}, error:${JSON.stringify(e)}`),p.alert(this.switchTip))}catch{p.alert(this.switchTip)}},onClickItem(r){const t=this.$router.resolve({path:`/detail/${r}`});window.open(t.href,"_blank")},openLink(r){window.open(r,"_blank")}}},T={class:"main-page cyber-page-base main-page-bg"},L={class:"container"},P={key:0,class:"inscriptions-grid"},D=["onClick"],U={key:0,class:"card-content text-content"},q={class:"text-preview"},M={key:1,class:"card-content image-content"},F=["src","width","height"],A={key:2,class:"card-content audio-content"},N={class:"audio-info"},R={class:"audio-title"},S={key:0,controls:"",class:"audio-player"},W=["src"],B={key:3,class:"card-content text-content"},z={class:"card-overlay"},H={class:"card-id"},O={key:1,class:"loading-content"},E={key:2,class:"pagination-section glass-container-enhanced"},V={class:"pagination-info"},j={class:"total-count holographic-text"},J={key:3,class:"social-links"};function Y(r,t,e,o,n,i){const l=x,h=C;return d(),c("div",T,[t[10]||(t[10]=s("div",{class:"aurora-effect"},null,-1)),t[11]||(t[11]=s("div",{class:"nebula-effect nebula-cyan"},null,-1)),t[12]||(t[12]=s("div",{class:"nebula-effect nebula-magenta"},null,-1)),t[13]||(t[13]=s("div",{class:"circuit-overlay"},null,-1)),s("div",L,[t[9]||(t[9]=s("div",{class:"page-header"},[s("h2",{class:"section-title neon-text holographic-text"},"Latest Inscriptions")],-1)),n.bInitLoadFinish?(d(),c("div",P,[(d(!0),c(m,null,w(n.tableData,a=>(d(),c("div",{key:a.id,class:"inscription-card glass-container-enhanced",onClick:u=>i.onClickItem(a.id)},[a.dataType=="text"||a.dataType=="deploy-stx10"?(d(),c("div",U,[s("div",q,f(a.optInfo.text),1)])):a.dataType.startsWith("image/")?(d(),c("div",M,[a.optInfo.imageUrl.length>0?(d(),c("img",{key:0,src:a.optInfo.imageUrl,width:a.optInfo.imageWidth,height:a.optInfo.imageHeight,class:b({nn:a.optInfo.originImageWidth<=64&&a.optInfo.originImageHeight<=64&&a.optInfo.originImageWidth>0&&a.optInfo.originImageHeight>0})},null,10,F)):g("",!0)])):a.dataType.startsWith("audio/")?(d(),c("div",A,[s("div",N,[s("div",R,f(a.optInfo.audioName),1),a.optInfo.audioUrl.length>0?(d(),c("audio",S,[s("source",{src:a.optInfo.audioUrl,type:"audio/mpeg"},null,8,W),t[5]||(t[5]=v(" Your browser does not support the audio element. "))])):g("",!0)])])):(d(),c("div",B,"Not support")),s("div",z,[s("div",H,"#"+f(a.id),1)])],8,D))),128))])):g("",!0),n.bInitLoadFinish?g("",!0):(d(),c("div",O,[I(l,{animated:"",rows:5})])),n.bInitLoadFinish?(d(),c("div",E,[s("div",V,[s("span",j,"Total "+f(n.totalInscriptionCount),1)]),I(h,{"current-page":n.curPage,"onUpdate:currentPage":t[0]||(t[0]=a=>n.curPage=a),"page-size":n.kPageSize,"onUpdate:pageSize":t[1]||(t[1]=a=>n.kPageSize=a),total:n.totalInscriptionCount,layout:"prev, pager, next, jumper",class:"cyber-pagination",onCurrentChange:i.onClickChangePage},null,8,["current-page","page-size","total","onCurrentChange"])])):g("",!0),n.bInitLoadFinish?(d(),c("div",J,[s("div",{class:"social-link twitter glass-container-enhanced",onClick:t[2]||(t[2]=a=>i.openLink("https://twitter.com/stx10_"))},t[6]||(t[6]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",fill:"currentColor",class:"bi bi-twitter",viewBox:"0 0 16 16"},[s("path",{d:"M5.026 15c6.038 0 9.341-5.003 9.341-9.334q.002-.211-.006-.422A6.7 6.7 0 0 0 16 3.542a6.7 6.7 0 0 1-1.889.518 3.3 3.3 0 0 0 1.447-1.817 6.5 6.5 0 0 1-2.087.793A3.286 3.286 0 0 0 7.875 6.03a9.32 9.32 0 0 1-6.767-3.429 3.29 3.29 0 0 0 1.018 4.382A3.3 3.3 0 0 1 .64 6.575v.045a3.29 3.29 0 0 0 2.632 3.218 3.2 3.2 0 0 1-.865.115 3 3 0 0 1-.614-.057 3.28 3.28 0 0 0 3.067 2.277A6.6 6.6 0 0 1 .78 13.58a6 6 0 0 1-.78-.045A9.34 9.34 0 0 0 5.026 15"})],-1)])),s("div",{class:"social-link discord glass-container-enhanced",onClick:t[3]||(t[3]=a=>i.openLink("https://discord.gg/e6zdwqrvw6"))},t[7]||(t[7]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",fill:"currentColor",class:"bi bi-discord",viewBox:"0 0 16 16"},[s("path",{d:"M13.545 2.907a13.2 13.2 0 0 0-3.257-1.011.05.05 0 0 0-.052.025c-.141.25-.297.577-.406.833a12.2 12.2 0 0 0-3.658 0 8 8 0 0 0-.412-.833.05.05 0 0 0-.052-.025c-1.125.194-2.22.534-3.257 1.011a.04.04 0 0 0-.021.018C.356 6.024-.213 9.047.066 12.032q.003.022.021.037a13.3 13.3 0 0 0 3.995 2.02.05.05 0 0 0 .056-.019q.463-.63.818-1.329a.05.05 0 0 0-.01-.059l-.018-.011a9 9 0 0 1-1.248-.595.05.05 0 0 1-.02-.066l.015-.019q.127-.095.248-.195a.05.05 0 0 1 .051-.007c2.619 1.196 5.454 1.196 8.041 0a.05.05 0 0 1 .053.007q.121.1.248.195a.05.05 0 0 1-.004.085 8 8 0 0 1-1.249.594.05.05 0 0 0-.03.03.05.05 0 0 0 .003.041c.24.465.515.909.817 1.329a.05.05 0 0 0 .056.019 13.2 13.2 0 0 0 4.001-2.02.05.05 0 0 0 .021-.037c.334-3.451-.559-6.449-2.366-9.106a.03.03 0 0 0-.02-.019m-8.198 7.307c-.789 0-1.438-.724-1.438-1.612s.637-1.613 1.438-1.613c.807 0 1.45.73 1.438 1.613 0 .888-.637 1.612-1.438 1.612m5.316 0c-.788 0-1.438-.724-1.438-1.612s.637-1.613 1.438-1.613c.807 0 1.451.73 1.438 1.613 0 .888-.631 1.612-1.438 1.612"})],-1)])),s("div",{class:"social-link telegram glass-container-enhanced",onClick:t[4]||(t[4]=a=>i.openLink("https://t.me/stacksinscription"))},t[8]||(t[8]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",fill:"currentColor",class:"bi bi-telegram",viewBox:"0 0 16 16"},[s("path",{d:"M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0M8.287 5.906q-1.168.486-4.666 2.01-.567.225-.595.442c-.03.243.275.339.69.47l.175.055c.408.133.958.288 1.243.294q.39.01.868-.32 3.269-2.206 3.374-2.23c.05-.012.12-.026.166.016s.042.12.037.141c-.03.129-1.227 1.241-1.846 1.817-.193.18-.33.307-.358.336a8 8 0 0 1-.188.186c-.38.366-.664.64.015 1.088.327.216.589.393.85.571.284.194.568.387.936.629q.14.092.27.187c.331.236.63.448.997.414.214-.02.435-.22.547-.82.265-1.417.786-4.486.906-5.751a1.4 1.4 0 0 0-.013-.315.34.34 0 0 0-.114-.217.53.53 0 0 0-.31-.093c-.3.005-.763.166-2.984 1.09"})],-1)]))])):g("",!0)])])}const Z=k(_,[["render",Y],["__scopeId","data-v-ffa86155"]]);export{Z as default};
