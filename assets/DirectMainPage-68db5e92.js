import{a as N,j as A,k as V,u as O,l as Q,U as C,r as U,b as D,m as H,o as s,c as r,d as e,n as m,t as g,g as l,f as b,w as v,q as W,s as F,v as T,x as z,y as B,p as j,h as q}from"./index-6e4fec84.js";import{C as L,c as M}from"./ContractHelper-472cfee8.js";import{C as S}from"./ChainHelper-36ca7a88.js";import{f as P}from"./browser-ponyfill-bb6ff9de.js";const R=z(),w=B(),E={name:"DirectMainPage",components:{},data(){return{kFixImageHeight:400,bLoadSummaryFinish:!1,curId:1,maxId:10,totalAmount:0,curInsData:{bLoading:!1,curInscriptionId:"",block:0,dataType:"",dataLength:"",payload:"",owner:"",bInQueryOwner:!1,bInQueryMintTx:!1,optInfo:{imageUrl:"",imageWidth:"",originImageWidth:0,originImageHeight:0,text:""}},bNonDSMode:!0}},async mounted(){await this.loadSummary(),this.totalAmount>0&&this.showInscription(this.maxId)},methods:{_inGetNetType(){return A()},async loadSummary(){const n=await L.loadSummary();this.totalAmount=parseInt(n.last_token_id),this.curId=this.maxId=Math.max(this.totalAmount,1),this.bLoadSummaryFinish=!0},async onClickChangeInscriptionId(){this.curId>=1&&this.curId<=this.maxId&&this.showInscription(this.curId)},async showInscription(n){this.curId=n;const o=V(O(this.curId));try{this.curInsData.bLoading=!0,this.curInsData.bInQueryOwner=!1,this.curInsData.bInQueryMintTx=!1;const _=await P(`${R.coreApiUrl}/v2/map_entry/${w.defaultContractAddress}/${w.inscriptionsContract.name}/map_inscriptions`,{method:"post",headers:{Accept:"application/json","Content-Type":"application/json"},proof:0,body:JSON.stringify(o)});if(_.status==200){const t=await _.json(),h=Q(t.data).value.data,x=Number(M(h.block)),d=M(h.type),p=h.payload.buffer,k=p.length;let a={imageUrl:null,text:null},c=!1;if(d.startsWith("image/")){a.imageUrl=window.URL.createObjectURL(new Blob([p],{type:d})),c=!0;var u=new Image;u.src=a.imageUrl;let f=this;u.onload=function(){f.curInsData.bLoading=!1,f.curInsData.optInfo.imageWidth=Math.ceil(u.width*f.kFixImageHeight/u.height),f.curInsData.optInfo.originImageWidth=u.width,f.curInsData.optInfo.originImageHeight=u.height}}else(d=="text"||d=="deploy-stx10")&&(a.text=new TextDecoder().decode(h.payload.buffer));c||(this.curInsData.bLoading=!1);let i=this.curInsData;i.curInscriptionId=n,i.block=x,i.dataType=d,i.dataLength=k,i.payload=p,i.owner="",i.bInQueryOwner=!1,i.bInQueryMintTx=!1,i.optInfo.imageUrl=a.imageUrl,i.optInfo.imageWidth=a.imageWidth,i.originImageWidth=a.originImageWidth,i.originImageHeight=a.originImageHeight,i.optInfo.text=a.text}else C.alert(`Request server fail, tokenId=${this.curId}, code=${_.status}, please try again 1 minute later.`)}catch{C.alert(`Request server fail, tokenId=${this.curId}, please try again 1 minute later.`)}finally{this.curInsData.bLoading=!1}},async onClickQueryOwner(){const n=this.curInsData.curInscriptionId;this.curInsData.bInQueryOwner=!0;const o=await L.queryNFTOwner(n);this.curInsData.bInQueryOwner=!1,n==this.curInsData.curInscriptionId&&n==this.curId&&(this.curInsData.owner=o||"")},async onClickOpenMintTx(){const n=this.curInsData.curInscriptionId;this.curInsData.bInQueryMintTx=!0;const o=await S.queryNFTHistory(w.defaultContractAddress,w.inscriptionsContract.name,"inscription",n);this.curInsData.bInQueryMintTx=!1,o&&S.openTxInBrowser(o)},onClickLatest(){this.showInscription(this.maxId)},onChangeDSMode(){setTimeout(()=>{U.push({path:"/",replace:!0})},100)}}},y=n=>(j("data-v-958dc861"),n=n(),q(),n),G={id:"main"},J={id:"title"},K={key:0},X={key:0,id:"searchArea"},Y=y(()=>e("span",{id:"id"},"ID:",-1)),Z={key:1,id:"inscInfoArea"},$={id:"previewPayload"},tt={key:0},et={key:1},nt=["src","width","height"],ot={key:2},it={id:"briefInfoArea"},st=y(()=>e("span",null,"Block: ",-1)),at=y(()=>e("span",null,"Content type: ",-1)),rt=y(()=>e("span",null,"Content length: ",-1)),ct=y(()=>e("span",null,"Owner: ",-1)),lt=["href"],ut=y(()=>e("span",null,"Mint tx: ",-1)),dt={key:2,id:"emptyTip"},It={id:"dsArea"};function ht(n,o,u,_,t,I){const h=D("el-input-number"),x=D("el-space"),d=D("el-input"),p=D("el-button"),k=D("el-switch"),a=H("loading");return s(),r("div",G,[e("div",J,[m("Total Inscriptions: "),t.bLoadSummaryFinish?(s(),r("span",K,g(t.totalAmount),1)):l("",!0)]),t.bLoadSummaryFinish&&t.totalAmount>0?(s(),r("div",X,[b(x,{size:"large"},{default:v(()=>[Y,b(h,{modelValue:t.curId,"onUpdate:modelValue":o[0]||(o[0]=c=>t.curId=c),min:1,max:t.maxId,size:"large",onChange:I.onClickChangeInscriptionId,disabled:t.curInsData.bLoading},null,8,["modelValue","max","onChange","disabled"])]),_:1})])):l("",!0),t.totalAmount>0?W((s(),r("fieldset",Z,[e("legend",null,"Inscription #"+g(t.curInsData.curInscriptionId),1),e("div",$,[!t.curInsData.bLoading&&(t.curInsData.dataType=="text"||t.curInsData.dataType=="deploy-stx10")?(s(),r("div",tt,[b(d,{modelValue:t.curInsData.optInfo.text,"onUpdate:modelValue":o[1]||(o[1]=c=>t.curInsData.optInfo.text=c),readonly:"",type:"textarea",autosize:"",resize:"none"},null,8,["modelValue"])])):!t.curInsData.bLoading&&t.curInsData.dataType.startsWith("image/")?(s(),r("div",et,[e("img",{src:t.curInsData.optInfo.imageUrl,width:t.curInsData.optInfo.imageWidth,height:t.kFixImageHeight,class:F({nn:t.curInsData.optInfo.originImageWidth<=64&&t.curInsData.optInfo.originImageHeight<=64&&t.curInsData.optInfo.originImageWidth>0&&t.curInsData.optInfo.originImageHeight>0}),alt:""},null,10,nt)])):t.curInsData.bLoading?l("",!0):(s(),r("div",ot," Not support preview yet. "))]),e("div",it,[e("div",null,[st,m(g(t.curInsData.block),1)]),e("div",null,[at,m(g(t.curInsData.dataType),1)]),e("div",null,[rt,m(" "+g(t.curInsData.dataLength)+" bytes ",1)]),e("div",null,[ct,t.curInsData.owner.length>0?(s(),r("a",{key:0,style:{color:"white"},href:"https://explorer.hiro.so/address/"+t.curInsData.owner+"?chain="+I._inGetNetType(),target:"_blank"},g(t.curInsData.owner),9,lt)):l("",!0),t.curInsData.owner.length==0?(s(),T(p,{key:1,loading:t.curInsData.bInQueryOwner,type:"info",size:"small",onClick:I.onClickQueryOwner},{default:v(()=>[m("Query")]),_:1},8,["loading","onClick"])):l("",!0)]),e("div",null,[ut,b(p,{loading:t.curInsData.bInQueryMintTx,type:"info",size:"small",onClick:I.onClickOpenMintTx},{default:v(()=>[m("Open")]),_:1},8,["loading","onClick"])])])])),[[a,t.curInsData.bLoading]]):l("",!0),t.bLoadSummaryFinish&&t.totalAmount==0?(s(),r("div",dt,"No inscription yet")):l("",!0),e("div",It,[t.bLoadSummaryFinish?(s(),T(k,{key:0,modelValue:t.bNonDSMode,"onUpdate:modelValue":o[2]||(o[2]=c=>t.bNonDSMode=c),"active-text":"Non dedicate server","inactive-text":"Dedicate server",onChange:I.onChangeDSMode},null,8,["modelValue","onChange"])):l("",!0)])])}const _t=N(E,[["render",ht],["__scopeId","data-v-958dc861"]]);export{_t as default};
