import{a as N,j as O,k as H,u as S,l as V,U as C,b as y,m as A,o as i,c,d as a,f as _,w as D,q as T,n as I,g as d,s as Q,t as m,v as B,x as F,y as j,z as P,p as R,h as q}from"./index-47ca5ae9.js";import{C as W,c as U}from"./ContractHelper-8f23a03a.js";import{f as z}from"./browser-ponyfill-3bf33254.js";const E=F(),x=j(),G={name:"InscriptionPage",components:{},data(){return{defaultReadonlyAddress:x.defaultContractAddress,kFixImageHeight:400,bLoadSummaryFinish:!1,curId:1,maxId:10,totalAmount:0,curInsData:{bLoading:!1,curInscriptionId:"",block:0,dataType:"",dataLength:"",payload:"",owner:"",bInQueryOwner:!1,optInfo:{imageUrl:"",imageWidth:"",originImageWidth:0,originImageHeight:0,text:""}}}},watch:{$route(e,r){if(e.path.startsWith("/inscription/")){const s=e.params.id;this.showInscription(s)}}},async mounted(){this.$route.params.hasOwnProperty("id")&&(this.curId=parseInt(this.$route.params.id),!(!this.curId||this.curId<0)&&(this.showInscription(this.curId),this.loadSummary()))},methods:{_inGetNetType(){return O()},async loadSummary(){const e=await W.loadSummary();this.totalAmount=parseInt(e.last_token_id),this.maxId=Math.max(this.totalAmount,1),this.bLoadSummaryFinish=!0},async showInscription(e){this.curId=parseInt(e);const r=H(S(this.curId));try{this.curInsData.bLoading=!0;const p=await z(`${E.coreApiUrl}/v2/map_entry/${x.defaultContractAddress}/${x.inscriptionsContract.name}/map_inscriptions`,{method:"post",headers:{Accept:"application/json","Content-Type":"application/json"},proof:0,body:JSON.stringify(r)});if(p.status==200){const t=await p.json(),h=V(t.data);if(h.type==9){this.curInsData.curInscriptionId=e,this.curInsData.block=0,this.curInsData.dataType="",this.curInsData.dataLength=0,this.curInsData.payload="",this.curInsData.owner="",this.curInsData.bInQueryOwner=!1,this.curInsData.optInfo.imageUrl="",this.curInsData.optInfo.imageWidth=0,this.curInsData.optInfo.originImageWidth=0,this.curInsData.optInfo.originImageHeight=0,this.curInsData.optInfo.text="",this.curInsData.bLoading=!1;return}const l=h.value.data,b=Number(U(l.block)),u=U(l.type),g=l.payload.buffer,k=g.length;let o={imageUrl:null,text:null},v=!1;if(u.startsWith("image/")){o.imageUrl=window.URL.createObjectURL(new Blob([g],{type:u})),v=!0;var s=new Image;s.src=o.imageUrl;let L=this;s.onload=function(){let f=L.curInsData;f.bLoading=!1,f.optInfo.imageWidth=Math.ceil(s.width*L.kFixImageHeight/s.height),f.optInfo.originImageWidth=s.width,f.optInfo.originImageHeight=s.height}}else(u=="text"||u=="deploy-stx10")&&(o.text=new TextDecoder().decode(l.payload.buffer));v||(this.curInsData.bLoading=!1);let n=this.curInsData;n.curInscriptionId=e,n.block=b,n.dataType=u,n.dataLength=k,n.payload=g,n.owner="",n.bInQueryOwner=!1,n.optInfo.imageUrl=o.imageUrl,n.optInfo.imageWidth=o.imageWidth,n.optInfo.originImageWidth=o.originImageWidth,n.optInfo.originImageHeight=o.originImageHeight,n.optInfo.text=o.text}else C.alert(`Request server fail, tokenId=${this.curId}, code=${p.status}, please try again 1 minute later.`)}catch{C.alert(`Request server fail, tokenId=${this.curId}, please try again 1 minute later.`)}finally{this.curInsData.bLoading=!1}},async onClickQueryOwner(){const e=this.curInsData.curInscriptionId;this.curInsData.bInQueryOwner=!0;const r=await W.queryNFTOwner(e);this.curInsData.bInQueryOwner=!1,e==this.curInsData.curInscriptionId&&e==this.curId&&(this.curInsData.owner=r||"")}}},w=e=>(R("data-v-097568af"),e=e(),q(),e),M={id:"main"},J={style:{"text-align":"left"}},K={id:"title"},X={key:0,"element-loading-background":"rgba(0, 0, 0, 0)",style:{"margin-top":"128px","min-height":"128px"}},Y={key:1,style:{"margin-top":"100px"}},Z={id:"previewPayload"},$={key:0,style:{width:"700px"}},tt={key:1},et=["src","width","height"],nt={key:2},at={key:2,id:"briefInfoArea"},ot=w(()=>a("span",null,"Block: ",-1)),st=w(()=>a("span",null,"Content type: ",-1)),it=w(()=>a("span",null,"Content length: ",-1)),rt=w(()=>a("span",null,"Owner: ",-1)),ct=["href"];function lt(e,r,s,p,t,h){const l=y("router-link"),b=y("el-space"),u=y("el-input"),g=y("el-button"),k=A("loading");return i(),c("div",M,[a("div",J,[_(b,{alignment:"center"},{default:D(()=>[a("div",K,"Inscription "+m(t.curId),1),T(_(l,{class:"menua",to:"/inscription/"+(t.curId-1),replace:""},{default:D(()=>[I("❮")]),_:1},8,["to"]),[[P,t.curId>1]]),_(l,{class:"menua",to:"/inscription/"+(t.curId+1),replace:""},{default:D(()=>[I("❯")]),_:1},8,["to"])]),_:1})]),t.curInsData.bLoading?T((i(),c("div",X,[I("   ")])),[[k,t.curInsData.bLoading]]):d("",!0),!t.curInsData.bLoading&&t.curInsData.block==0?(i(),c("div",Y,"Not exist.")):d("",!0),a("div",Z,[!t.curInsData.bLoading&&(t.curInsData.dataType=="text"||t.curInsData.dataType=="deploy-stx10")?(i(),c("div",$,[_(u,{modelValue:t.curInsData.optInfo.text,"onUpdate:modelValue":r[0]||(r[0]=o=>t.curInsData.optInfo.text=o),readonly:"",type:"textarea",autosize:""},null,8,["modelValue"])])):!t.curInsData.bLoading&&t.curInsData.dataType.startsWith("image/")?(i(),c("div",tt,[a("img",{src:t.curInsData.optInfo.imageUrl,width:t.curInsData.optInfo.imageWidth,height:t.kFixImageHeight,class:Q({nn:t.curInsData.optInfo.originImageWidth<=64&&t.curInsData.optInfo.originImageHeight<=64&&t.curInsData.optInfo.originImageWidth>0&&t.curInsData.optInfo.originImageHeight>0}),alt:""},null,10,et)])):!t.curInsData.bLoading&&t.curInsData.block>0?(i(),c("div",nt," Not support preview yet. ")):d("",!0)]),!t.curInsData.bLoading&&t.curInsData.block>0?(i(),c("div",at,[a("div",null,[ot,I(m(t.curInsData.block),1)]),a("div",null,[st,I(m(t.curInsData.dataType),1)]),a("div",null,[it,I(" "+m(t.curInsData.dataLength)+" bytes ",1)]),a("div",null,[rt,t.curInsData.owner.length>0?(i(),c("a",{key:0,style:{color:"white"},href:"https://explorer.hiro.so/address/"+t.curInsData.owner+"?chain="+h._inGetNetType(),target:"_blank"},m(t.curInsData.owner),9,ct)):d("",!0),t.curInsData.owner.length==0?(i(),B(g,{key:1,loading:t.curInsData.bInQueryOwner,type:"info",size:"small",onClick:h.onClickQueryOwner},{default:D(()=>[I("Query")]),_:1},8,["loading","onClick"])):d("",!0)])])):d("",!0)])}const pt=N(G,[["render",lt],["__scopeId","data-v-097568af"]]);export{pt as default};
