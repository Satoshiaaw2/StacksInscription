import{_ as x,c as g,o as m,a as n,b as y,t as u,e as d,d as C,w as f,k as v,F as M,r as P,n as T,l as w,ah as D,E as S,f as L,U as p}from"./index-BrsqEE9u.js";/* empty css                  *//* empty css                  *//* empty css                         */import{s as I}from"./supabase-COU5c0VB.js";import"./browser-ponyfill-Byz11RxX.js";const U={name:"CollectionDetailPage",data(){return{kFixImageHeight:400,collectionId:"",collectionName:"",loading:null,summary:{id:"",name:"",iconUrl:"",rangeStart:0,rangeEnd:0,detail:"",shortDetail:"",showMoreMode:0,website:"",twitter:"",discord:"",telegram:"",priority:0,idList:[]},totalInscriptionCount:0,curPage:1,kMaxImageLen:236,kPageSize:25,asyncInfo:{id:0,kMaxInRequestCount:15,kMaxRetryTimes:10,retryTimes:0,bFailFlag:!1,curInRequestCount:0},tableData:[],asyncInfo:{id:0,kMaxInRequestCount:8,kMaxRetryTimes:10,retryTimes:0,bFailFlag:!1,curInRequestCount:0}}},async mounted(){if(!this.$route.params.hasOwnProperty("id"))return;const o=this.$route.params.id;!o||o.length==0||(this.collectionId=o,this.loadCollectionDB(o),this.loadCollectionStorage(o))},methods:{async loadCollectionDB(o){const{data:a,error:s,status:i}=await I.from("collection").select("*").eq("id",o).limit(1);if(i==200&&!s&&a.length==1){const t=a[0];let e=this.summary;e.id=t.id,e.name=t.name,e.iconUrl=t.iconurl,e.rangeStart=t.startno,e.rangeEnd=t.endno,e.detail=t.detail,e.website=t.website,e.twitter=t.twitter,e.discord=t.discord,e.telegram=t.telegram,e.priority=t.priority,this.updateToggleFoldData()}else console.log("Load collection fail, status:",i,"error: ",s),p.alert("Load collection fail, please try later")},async loadCollectionStorage(o){const{data:a,error:s}=await I.storage.from("collection").download(o);if(s){p.alert("Load storage fail, please try later");return}const i=await a.text(),e=JSON.parse(i).split(",");this.summary.idList=[];for(const r of e)this.summary.idList.push(parseInt(r));this.totalInscriptionCount=this.summary.idList.length,this.showPage(1)},async showPage(o){this.curPage=o;let a=[];const s=(o-1)*this.kPageSize,i=Math.min(s+this.kPageSize,this.summary.idList.length);for(let c=s;c<i;c++){const h=this.summary.idList[c];a.push(h)}const{data:t,error:e,status:r}=await I.from("inscriptions").select("id, type, payload").order("id",{ascending:!0}).in("id",a).limit(this.kPageSize);r==200&&!e?this.setTableData(t):(console.log("showPage error:",o,e),p.alert("Load error, please try again later"))},setTableData(o){let a=[];this.tableData.splice(0,this.tableData.length);for(let s=0;s<o.length;s++){const i=o[s];let t={key:i.id,id:i.id,block:i.block,dataType:i.type,owner:"",payload:"",optInfo:{imageUrl:"",imageWidth:"",imageHeight:this.kMaxImageLen,originImageWidth:0,originImageHeight:0,text:""}};if(t.dataType=="text"||t.dataType=="deploy-stx10")t.payload=i.payload,t.optInfo.text=i.payload;else{const e=i.payload.split("_*|");e.length==3&&e[1].endsWith(`_${t.id}`)?a.push({index:s,inscData:t,syncUrl:e[1]}):console.log("setTableData error",e,t)}this.tableData.push(t)}this.syncTable(a)},async syncTable(o){if(!o||o.length==0)return;let a=this.asyncInfo.id+1;this.asyncInfo.id=a,this.asyncInfo.curInRequestCount=0,this.asyncInfo.retryTimes=0,this.asyncInfo.bFailFlag=!1;let s=0;for(;a==this.asyncInfo.id&&!this.asyncInfo.bFailFlag&&s<o.length;)this.asyncInfo.curInRequestCount<this.asyncInfo.kMaxInRequestCount?(++this.asyncInfo.curInRequestCount,this.syncOne(a,o[s++])):await new Promise(i=>setTimeout(i,1e3))},async syncOne(o,a){const s=a.inscData;let i=null,t=!1;for(;;){const r=localStorage.getItem(a.syncUrl);if(r){i=p.base64ToBlob(r,"text/plain");break}const{data:c,error:h}=await I.storage.from("payload").download(a.syncUrl);if(o!=this.asyncInfo.id)return;if(h){if(++this.asyncInfo.retryTimes>this.asyncInfo.kMaxRetryTimes){this.asyncInfo.bFailFlag=!0;return}await new Promise(_=>setTimeout(_,5e3))}i=c,t=!0;break}if(s.payload=i,s.dataType.startsWith("image/")){s.optInfo.imageUrl=window.URL.createObjectURL(new Blob([i],{type:s.dataType}));var e=new Image;e.src=s.optInfo.imageUrl;let r=this;e.onload=function(){s.optInfo.originImageWidth=e.width,s.optInfo.originImageHeight=e.height,e.width>e.height?(s.optInfo.imageWidth=r.kMaxImageLen,s.optInfo.imageHeight=Math.ceil(e.height*r.kMaxImageLen/e.width)):(s.optInfo.imageHeight=r.kMaxImageLen,s.optInfo.imageWidth=Math.ceil(e.width*r.kMaxImageLen/e.height)),s.key*=-1,r.$forceUpdate()},t&&p.blobToBase64(i,function(c){try{localStorage.setItem(a.syncUrl,c)}catch(h){h.toString().includes("exceeded the quota")&&(console.log("exceeded the quota, purge"),localStorage.clear())}})}this.asyncInfo.curInRequestCount=Math.max(this.asyncInfo.curInRequestCount-1,0)},async onClickChangePage(){this.showPage(this.curPage)},onClickItem(o){const a=this.$router.resolve({path:`/detail/${o}`});window.open(a.href,"_blank")},updateToggleFoldData(){this.summary.shortDetail="",this.summary.showMoreMode=0;const o=250;if(this.summary.detail.length>o){let a=o;for(let s=o;s<o+20;s++)if(this.summary.detail.substr(s,1)==" "){a=s;break}this.summary.shortDetail=this.summary.detail.substr(0,a)+"...",this.summary.showMoreMode=1}},toggleShowMore(){this.summary.showMoreMode=this.summary.showMoreMode==1?2:1}}},R={class:"collection-detail-page"},F={class:"container"},q={class:"collection-header"},z={class:"collection-icon"},B=["src","alt"],E={class:"collection-name neon-text"},N={key:0,class:"collection-range"},W={class:"collection-description"},H={class:"social-links"},V=["href"],A={class:"nft-grid-section"},O={class:"nft-grid"},j=["onClick"],J={key:0,class:"nft-image-container"},G=["src","alt"],K={class:"nft-overlay"},Q={class:"nft-id"},X={class:"view-icon"},Y={key:1,class:"nft-loading"},Z={key:0,class:"pagination-section"},$={class:"collection-animations"},tt={class:"floating-nft-icon icon-1"};function et(o,a,s,i,t,e){const r=v,c=w("View"),h=D,_=S,k=L,b=w("PictureRounded");return m(),g("div",R,[n("div",F,[n("div",q,[n("div",z,[n("img",{src:t.summary.iconUrl,alt:t.summary.name},null,8,B)]),n("h2",E,u(t.summary.name),1),t.summary.rangeStart>0?(m(),g("div",N," #"+u(t.summary.rangeStart)+" - #"+u(t.summary.rangeEnd),1)):y("",!0),n("p",W,u(t.summary.detail),1),n("div",H,[n("a",{href:t.summary.twitter,target:"_blank",class:"twitter-link"},[d(r,{size:"20"},{default:f(()=>a[2]||(a[2]=[n("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",fill:"currentColor",class:"bi bi-twitter",viewBox:"0 0 16 16"},[n("path",{d:"M5.026 15c6.038 0 9.341-5.003 9.341-9.334q.002-.211-.006-.422A6.7 6.7 0 0 0 16 3.542a6.7 6.7 0 0 1-1.889.518 3.3 3.3 0 0 0 1.447-1.817 6.5 6.5 0 0 1-2.087.793A3.286 3.286 0 0 0 7.875 6.03a9.32 9.32 0 0 1-6.767-3.429 3.29 3.29 0 0 0 1.018 4.382A3.3 3.3 0 0 1 .64 6.575v.045a3.29 3.29 0 0 0 2.632 3.218 3.2 3.2 0 0 1-.865.115 3 3 0 0 1-.614-.057 3.28 3.28 0 0 0 3.067 2.277A6.6 6.6 0 0 1 .78 13.58a6 6 0 0 1-.78-.045A9.34 9.34 0 0 0 5.026 15"})],-1)])),_:1,__:[2]}),C(" "+u(t.summary.twitter.substring(t.summary.twitter.lastIndexOf("/")+1)),1)],8,V)])]),n("div",A,[n("div",O,[(m(!0),g(M,null,P(t.tableData,l=>(m(),g("div",{key:l.id,class:"nft-card",onClick:st=>e.onClickItem(l.id)},[l.optInfo.imageUrl.length>0?(m(),g("div",J,[n("img",{src:l.optInfo.imageUrl,alt:`NFT #${l.id}`,class:T(["nft-image",{nn:l.optInfo.originImageWidth<=64&&l.optInfo.originImageHeight<=64&&l.optInfo.originImageWidth>0&&l.optInfo.originImageHeight>0}])},null,10,G),n("div",K,[n("div",Q,"#"+u(l.id),1),n("div",X,[d(r,{size:"24"},{default:f(()=>[d(c)]),_:1})])])])):y("",!0),l.optInfo.imageUrl.length==0?(m(),g("div",Y,[d(_,{animated:""},{template:f(()=>[d(h,{variant:"image",style:{width:"250px",height:"250px"}})]),_:1})])):y("",!0)],8,j))),128))])]),t.tableData.length>0?(m(),g("div",Z,[d(k,{"current-page":t.curPage,"onUpdate:currentPage":a[0]||(a[0]=l=>t.curPage=l),"page-size":t.kPageSize,"onUpdate:pageSize":a[1]||(a[1]=l=>t.kPageSize=l),total:t.totalInscriptionCount,layout:"prev, pager, next, total, jumper",class:"cyber-pagination",onCurrentChange:e.onClickChangePage},null,8,["current-page","page-size","total","onCurrentChange"])])):y("",!0),n("div",$,[n("div",tt,[d(r,{size:"50"},{default:f(()=>[d(b)]),_:1})]),a[3]||(a[3]=n("div",{class:"grid-overlay"},null,-1))])])])}const ct=x(U,[["render",et],["__scopeId","data-v-98c83ce7"]]);export{ct as default};
