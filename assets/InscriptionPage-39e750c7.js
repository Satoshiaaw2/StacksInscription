import{_ as H,i as N,j as U,u as M,k as S,U as C,a as w,l as A,o as r,c,b as n,e as m,w as f,n as L,m as l,f as h,q as V,t as y,s as B,v as F,x as j,y as q,p as P,g as R}from"./index-a9102307.js";import{C as O,c as W}from"./ContractHelper-5416b8cd.js";import{C as Q}from"./ChainHelper-08579cdd.js";import{f as z}from"./browser-ponyfill-20e308dd.js";const E=F(),_=j(),G={name:"InscriptionPage",components:{},data(){return{defaultReadonlyAddress:_.defaultContractAddress,kFixImageHeight:400,bLoadSummaryFinish:!1,curId:1,maxId:10,totalAmount:0,curInsData:{bLoading:!1,curInscriptionId:"",block:0,dataType:"",dataLength:"",payload:"",owner:"",bInQueryOwner:!1,bInQueryMintTx:!1,optInfo:{imageUrl:"",imageWidth:"",originImageWidth:0,originImageHeight:0,text:""}}}},watch:{$route(e,s){if(e.path.startsWith("/inscription/")){const o=e.params.id;this.showInscription(o)}}},async mounted(){this.$route.params.hasOwnProperty("id")&&(this.curId=parseInt(this.$route.params.id),!(!this.curId||this.curId<0)&&(this.showInscription(this.curId),this.loadSummary()))},methods:{_inGetNetType(){return N()},async loadSummary(){const e=await O.loadSummary();this.totalAmount=parseInt(e.last_token_id),this.maxId=Math.max(this.totalAmount,1),this.bLoadSummaryFinish=!0},async showInscription(e){this.curId=parseInt(e);const s=U(M(this.curId));try{this.curInsData.bLoading=!0;const g=await z(`${E.coreApiUrl}/v2/map_entry/${_.defaultContractAddress}/${_.inscriptionsContract.name}/map_inscriptions`,{method:"post",headers:{Accept:"application/json","Content-Type":"application/json"},proof:0,body:JSON.stringify(s)});if(g.status==200){const t=await g.json(),d=S(t.data);if(d.type==9){this.curInsData.curInscriptionId=e,this.curInsData.block=0,this.curInsData.dataType="",this.curInsData.dataLength=0,this.curInsData.payload="",this.curInsData.owner="",this.curInsData.bInQueryOwner=!1,this.curInsData.bInQueryMintTx=!1,this.curInsData.optInfo.imageUrl="",this.curInsData.optInfo.imageWidth=0,this.curInsData.optInfo.originImageWidth=0,this.curInsData.optInfo.originImageHeight=0,this.curInsData.optInfo.text="",this.curInsData.bLoading=!1;return}const u=d.value.data,x=Number(W(u.block)),I=W(u.type),p=u.payload.buffer,k=p.length;let i={imageUrl:null,text:null},v=!1;if(I.startsWith("image/")){i.imageUrl=window.URL.createObjectURL(new Blob([p],{type:I})),v=!0;var o=new Image;o.src=i.imageUrl;let T=this;o.onload=function(){let b=T.curInsData;b.bLoading=!1,b.optInfo.imageWidth=Math.ceil(o.width*T.kFixImageHeight/o.height),b.optInfo.originImageWidth=o.width,b.optInfo.originImageHeight=o.height}}else(I=="text"||I=="deploy-stx10")&&(i.text=new TextDecoder().decode(u.payload.buffer));v||(this.curInsData.bLoading=!1);let a=this.curInsData;a.curInscriptionId=e,a.block=x,a.dataType=I,a.dataLength=k,a.payload=p,a.owner="",a.bInQueryOwner=!1,a.bInQueryMintTx=!1,a.optInfo.imageUrl=i.imageUrl,a.optInfo.imageWidth=i.imageWidth,a.optInfo.originImageWidth=i.originImageWidth,a.optInfo.originImageHeight=i.originImageHeight,a.optInfo.text=i.text}else C.alert(`Request server fail, tokenId=${this.curId}, code=${g.status}, please try again 1 minute later.`)}catch{C.alert(`Request server fail, tokenId=${this.curId}, please try again 1 minute later.`)}finally{this.curInsData.bLoading=!1}},async onClickQueryOwner(){const e=this.curInsData.curInscriptionId;this.curInsData.bInQueryOwner=!0;const s=await O.queryNFTOwner(e);this.curInsData.bInQueryOwner=!1,e==this.curInsData.curInscriptionId&&e==this.curId&&(this.curInsData.owner=s||"")},async onClickOpenMintTx(){const e=this.curInsData.curInscriptionId;this.curInsData.bInQueryMintTx=!0;const s=await Q.queryNFTHistory(_.defaultContractAddress,_.inscriptionsContract.name,"inscription",e);this.curInsData.bInQueryMintTx=!1,s&&Q.openTxInBrowser(s)}}},D=e=>(P("data-v-b1a3f938"),e=e(),R(),e),J={id:"main"},K={style:{"text-align":"left"}},X={id:"title"},Y={key:0,"element-loading-background":"rgba(0, 0, 0, 0)",style:{"margin-top":"128px","min-height":"128px"}},Z={key:1,style:{"margin-top":"100px"}},$={id:"previewPayload"},tt={key:0,style:{width:"700px"}},et={key:1},nt=["src","width","height"],at={key:2},st={key:2,id:"briefInfoArea"},it=D(()=>n("span",null,"Block: ",-1)),ot=D(()=>n("span",null,"Content type: ",-1)),rt=D(()=>n("span",null,"Content length: ",-1)),ct=D(()=>n("span",null,"Owner: ",-1)),lt=["href"],ut=D(()=>n("span",null,"Mint tx: ",-1));function It(e,s,o,g,t,d){const u=w("router-link"),x=w("el-space"),I=w("el-input"),p=w("el-button"),k=A("loading");return r(),c("div",J,[n("div",K,[m(x,{alignment:"center"},{default:f(()=>[n("div",X,"Inscription "+y(t.curId),1),L(m(u,{class:"menua",to:"/inscription/"+(t.curId-1),replace:""},{default:f(()=>[l("❮")]),_:1},8,["to"]),[[q,t.curId>1]]),m(u,{class:"menua",to:"/inscription/"+(t.curId+1),replace:""},{default:f(()=>[l("❯")]),_:1},8,["to"])]),_:1})]),t.curInsData.bLoading?L((r(),c("div",Y,[l("   ")])),[[k,t.curInsData.bLoading]]):h("",!0),!t.curInsData.bLoading&&t.curInsData.block==0?(r(),c("div",Z,"Not exist.")):h("",!0),n("div",$,[!t.curInsData.bLoading&&(t.curInsData.dataType=="text"||t.curInsData.dataType=="deploy-stx10")?(r(),c("div",tt,[m(I,{modelValue:t.curInsData.optInfo.text,"onUpdate:modelValue":s[0]||(s[0]=i=>t.curInsData.optInfo.text=i),readonly:"",type:"textarea",autosize:""},null,8,["modelValue"])])):!t.curInsData.bLoading&&t.curInsData.dataType.startsWith("image/")?(r(),c("div",et,[n("img",{src:t.curInsData.optInfo.imageUrl,width:t.curInsData.optInfo.imageWidth,height:t.kFixImageHeight,class:V({nn:t.curInsData.optInfo.originImageWidth<=64&&t.curInsData.optInfo.originImageHeight<=64&&t.curInsData.optInfo.originImageWidth>0&&t.curInsData.optInfo.originImageHeight>0}),alt:""},null,10,nt)])):!t.curInsData.bLoading&&t.curInsData.block>0?(r(),c("div",at," Not support preview yet. ")):h("",!0)]),!t.curInsData.bLoading&&t.curInsData.block>0?(r(),c("div",st,[n("div",null,[it,l(y(t.curInsData.block),1)]),n("div",null,[ot,l(y(t.curInsData.dataType),1)]),n("div",null,[rt,l(" "+y(t.curInsData.dataLength)+" bytes ",1)]),n("div",null,[ct,t.curInsData.owner.length>0?(r(),c("a",{key:0,style:{color:"white"},href:"https://explorer.hiro.so/address/"+t.curInsData.owner+"?chain="+d._inGetNetType(),target:"_blank"},y(t.curInsData.owner),9,lt)):h("",!0),t.curInsData.owner.length==0?(r(),B(p,{key:1,loading:t.curInsData.bInQueryOwner,type:"info",size:"small",onClick:d.onClickQueryOwner},{default:f(()=>[l("Query")]),_:1},8,["loading","onClick"])):h("",!0)]),n("div",null,[ut,m(p,{loading:t.curInsData.bInQueryMintTx,type:"info",size:"small",onClick:d.onClickOpenMintTx},{default:f(()=>[l("Open")]),_:1},8,["loading","onClick"])])])):h("",!0)])}const mt=H(G,[["render",It],["__scopeId","data-v-b1a3f938"]]);export{mt as default};
