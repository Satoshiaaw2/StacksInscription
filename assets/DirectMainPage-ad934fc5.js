import{a as N,j as V,k as A,u as U,l as W,U as x,r as H,b as y,m as F,o as a,c as r,d as e,n as f,t as p,g as l,f as v,w as k,q as M,s as z,v as C,x as B,y as O,p as j,h as q}from"./index-47ca5ae9.js";import{C as L,c as T}from"./ContractHelper-8f23a03a.js";import{f as P}from"./browser-ponyfill-3bf33254.js";const R=B(),S=O(),Q={name:"DirectMainPage",components:{},data(){return{kFixImageHeight:400,bLoadSummaryFinish:!1,curId:1,maxId:10,totalAmount:0,curInsData:{bLoading:!1,curInscriptionId:"",block:0,dataType:"",dataLength:"",payload:"",owner:"",optInfo:{imageUrl:"",imageWidth:"",originImageWidth:0,originImageHeight:0,text:""}},bNonDSMode:!0}},async mounted(){await this.loadSummary(),this.totalAmount>0&&this.showInscription(this.maxId)},methods:{_inGetNetType(){return V()},async loadSummary(){const n=await L.loadSummary();this.totalAmount=parseInt(n.last_token_id),this.curId=this.maxId=Math.max(this.totalAmount,1),this.bLoadSummaryFinish=!0},async onClickChangeInscriptionId(){this.curId>=1&&this.curId<=this.maxId&&this.showInscription(this.curId)},async showInscription(n){this.curId=n;const o=A(U(this.curId));try{this.curInsData.bLoading=!0;const I=await P(`${R.coreApiUrl}/v2/map_entry/${S.defaultContractAddress}/${S.inscriptionsContract.name}/map_inscriptions`,{method:"post",headers:{Accept:"application/json","Content-Type":"application/json"},proof:0,body:JSON.stringify(o)});if(I.status==200){const t=await I.json(),h=W(t.data).value.data,b=Number(T(h.block)),u=T(h.type),g=h.payload.buffer,w=g.length;let s={imageUrl:null,text:null},c=!1;if(u.startsWith("image/")){s.imageUrl=window.URL.createObjectURL(new Blob([g],{type:u})),c=!0;var d=new Image;d.src=s.imageUrl;let _=this;d.onload=function(){_.curInsData.bLoading=!1,_.curInsData.optInfo.imageWidth=Math.ceil(d.width*_.kFixImageHeight/d.height),_.curInsData.optInfo.originImageWidth=d.width,_.curInsData.optInfo.originImageHeight=d.height}}else(u=="text"||u=="deploy-stx10")&&(s.text=new TextDecoder().decode(h.payload.buffer));c||(this.curInsData.bLoading=!1);let i=this.curInsData;i.curInscriptionId=n,i.block=b,i.dataType=u,i.dataLength=w,i.payload=g,i.owner="",i.optInfo.imageUrl=s.imageUrl,i.optInfo.imageWidth=s.imageWidth,i.originImageWidth=s.originImageWidth,i.originImageHeight=s.originImageHeight,i.optInfo.text=s.text}else x.alert(`Request server fail, tokenId=${this.curId}, code=${I.status}, please try again 1 minute later.`)}catch{x.alert(`Request server fail, tokenId=${this.curId}, please try again 1 minute later.`)}finally{this.curInsData.bLoading=!1}},async onClickQueryOwner(){const n=this.curInsData.curInscriptionId,o=await L.queryNFTOwner(n);n==this.curInsData.curInscriptionId&&n==this.curId&&(this.curInsData.owner=o||"")},onClickLatest(){this.showInscription(this.maxId)},onChangeDSMode(){setTimeout(()=>{H.push({path:"/",replace:!0})},100)}}},D=n=>(j("data-v-08004e64"),n=n(),q(),n),E={id:"main"},G={id:"title"},J={key:0},K={key:0,id:"searchArea"},X=D(()=>e("span",{id:"id"},"ID:",-1)),Y={key:1,id:"inscInfoArea"},Z={id:"previewPayload"},$={key:0},tt={key:1},et=["src","width","height"],nt={key:2},ot={id:"briefInfoArea"},it=D(()=>e("span",null,"Block: ",-1)),at=D(()=>e("span",null,"Content type: ",-1)),st=D(()=>e("span",null,"Content length: ",-1)),rt=D(()=>e("span",null,"Owner: ",-1)),ct=["href"],lt={key:2,id:"emptyTip"},dt={id:"dsArea"};function ut(n,o,d,I,t,m){const h=y("el-input-number"),b=y("el-space"),u=y("el-input"),g=y("el-button"),w=y("el-switch"),s=F("loading");return a(),r("div",E,[e("div",G,[f("Total Inscriptions: "),t.bLoadSummaryFinish?(a(),r("span",J,p(t.totalAmount),1)):l("",!0)]),t.bLoadSummaryFinish&&t.totalAmount>0?(a(),r("div",K,[v(b,{size:"large"},{default:k(()=>[X,v(h,{modelValue:t.curId,"onUpdate:modelValue":o[0]||(o[0]=c=>t.curId=c),min:1,max:t.maxId,size:"large",onChange:m.onClickChangeInscriptionId,disabled:t.curInsData.bLoading},null,8,["modelValue","max","onChange","disabled"])]),_:1})])):l("",!0),t.totalAmount>0?M((a(),r("fieldset",Y,[e("legend",null,"Inscription #"+p(t.curInsData.curInscriptionId),1),e("div",Z,[!t.curInsData.bLoading&&(t.curInsData.dataType=="text"||t.curInsData.dataType=="deploy-stx10")?(a(),r("div",$,[v(u,{modelValue:t.curInsData.optInfo.text,"onUpdate:modelValue":o[1]||(o[1]=c=>t.curInsData.optInfo.text=c),readonly:"",type:"textarea",autosize:"",resize:"none"},null,8,["modelValue"])])):!t.curInsData.bLoading&&t.curInsData.dataType.startsWith("image/")?(a(),r("div",tt,[e("img",{src:t.curInsData.optInfo.imageUrl,width:t.curInsData.optInfo.imageWidth,height:t.kFixImageHeight,class:z({nn:t.curInsData.optInfo.originImageWidth<=64&&t.curInsData.optInfo.originImageHeight<=64&&t.curInsData.optInfo.originImageWidth>0&&t.curInsData.optInfo.originImageHeight>0}),alt:""},null,10,et)])):t.curInsData.bLoading?l("",!0):(a(),r("div",nt," Not support preview yet. "))]),e("div",ot,[e("div",null,[it,f(p(t.curInsData.block),1)]),e("div",null,[at,f(p(t.curInsData.dataType),1)]),e("div",null,[st,f(" "+p(t.curInsData.dataLength)+" bytes ",1)]),e("div",null,[rt,t.curInsData.owner.length>0?(a(),r("a",{key:0,style:{color:"white"},href:"https://explorer.hiro.so/address/"+t.curInsData.owner+"?chain="+m._inGetNetType(),target:"_blank"},p(t.curInsData.owner),9,ct)):l("",!0),t.curInsData.owner.length==0?(a(),C(g,{key:1,type:"info",size:"small",onClick:m.onClickQueryOwner},{default:k(()=>[f("Query")]),_:1},8,["onClick"])):l("",!0)])])])),[[s,t.curInsData.bLoading]]):l("",!0),t.bLoadSummaryFinish&&t.totalAmount==0?(a(),r("div",lt,"No inscription yet")):l("",!0),e("div",dt,[t.bLoadSummaryFinish?(a(),C(w,{key:0,modelValue:t.bNonDSMode,"onUpdate:modelValue":o[2]||(o[2]=c=>t.bNonDSMode=c),"active-text":"Non dedicate server","inactive-text":"Dedicate server",onChange:m.onChangeDSMode},null,8,["modelValue","onChange"])):l("",!0)])])}const mt=N(Q,[["render",ut],["__scopeId","data-v-08004e64"]]);export{mt as default};
