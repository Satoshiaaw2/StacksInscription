import{_ as O,i as Q,j as H,u as M,k as S,U as T,a as x,l as V,o as r,c,b as n,e as _,w as D,n as C,m as u,f as p,q as B,t as g,s as P,v as F,x as R,y as j,p as q,g as z}from"./index-a518358d.js";import{C as N,c as U}from"./ContractHelper-5ee2cfa9.js";import{C as A}from"./ChainHelper-cd53e7ea.js";import{f as E}from"./browser-ponyfill-904aafac.js";const G=F(),b=R(),K={name:"InscriptionPage",components:{},data(){return{defaultReadonlyAddress:b.defaultContractAddress,kFixImageHeight:400,kAudioNameLen:64,kAudioDescLen:64,bLoadSummaryFinish:!1,curId:1,maxId:10,totalAmount:0,curInsData:{bLoading:!1,curInscriptionId:"",block:0,dataType:"",dataLength:"",payload:"",owner:"",bInQueryOwner:!1,bInQueryMintTx:!1,optInfo:{imageUrl:"",imageWidth:"",originImageWidth:0,originImageHeight:0,text:"",audioName:"",audioDesc:"",audioUrl:""}}}},watch:{$route(e,i){if(e.path.startsWith("/inscription/")){const l=e.params.id;this.showInscription(l)}}},async mounted(){this.$route.params.hasOwnProperty("id")&&(this.curId=parseInt(this.$route.params.id),!(!this.curId||this.curId<0)&&(this.showInscription(this.curId),this.loadSummary()))},methods:{_inGetNetType(){return Q()},async loadSummary(){const e=await N.loadSummary();this.totalAmount=parseInt(e.last_token_id),this.maxId=Math.max(this.totalAmount,1),this.bLoadSummaryFinish=!0},async showInscription(e){this.curId=parseInt(e);const i=H(M(this.curId));try{this.curInsData.bLoading=!0;const m=await E(`${G.coreApiUrl}/v2/map_entry/${b.defaultContractAddress}/${b.inscriptionsContract.name}/map_inscriptions`,{method:"post",headers:{Accept:"application/json","Content-Type":"application/json"},proof:0,body:JSON.stringify(i)});if(m.status==200){const t=await m.json(),f=S(t.data);if(f.type==9){this.curInsData.curInscriptionId=e,this.curInsData.block=0,this.curInsData.dataType="",this.curInsData.dataLength=0,this.curInsData.payload="",this.curInsData.owner="",this.curInsData.bInQueryOwner=!1,this.curInsData.bInQueryMintTx=!1,this.curInsData.optInfo.imageUrl="",this.curInsData.optInfo.imageWidth=0,this.curInsData.optInfo.originImageWidth=0,this.curInsData.optInfo.originImageHeight=0,this.curInsData.optInfo.text="",this.curInsData.bLoading=!1;return}const h=f.value.data,w=Number(U(h.block)),d=U(h.type),s=h.payload.buffer,v=s.length;let o={imageUrl:null,text:null},L=!1;if(d.startsWith("image/")){o.imageUrl=window.URL.createObjectURL(new Blob([s],{type:d})),L=!0;var l=new Image;l.src=o.imageUrl;let k=this;l.onload=function(){let y=k.curInsData;y.bLoading=!1,y.optInfo.imageWidth=Math.ceil(l.width*k.kFixImageHeight/l.height),y.optInfo.originImageWidth=l.width,y.optInfo.originImageHeight=l.height}}else if(d.startsWith("audio/")){const k=s.slice(s.length-this.kAudioNameLen-this.kAudioDescLen,s.length-this.kAudioDescLen);o.audioName=new TextDecoder().decode(k).trim();const y=s.slice(s.length-this.kAudioDescLen);o.audioDesc=new TextDecoder().decode(y).trim();const W=s.slice(0,s.length-this.kAudioNameLen-this.kAudioDescLen);o.audioUrl=window.URL.createObjectURL(new Blob([W],{type:d}))}else(d=="text"||d=="deploy-stx10")&&(o.text=new TextDecoder().decode(h.payload.buffer));L||(this.curInsData.bLoading=!1);let a=this.curInsData;a.curInscriptionId=e,a.block=w,a.dataType=d,a.dataLength=v,a.payload=s,a.owner="",a.bInQueryOwner=!1,a.bInQueryMintTx=!1,a.optInfo.imageUrl=o.imageUrl,a.optInfo.imageWidth=o.imageWidth,a.optInfo.originImageWidth=o.originImageWidth,a.optInfo.originImageHeight=o.originImageHeight,a.optInfo.text=o.text,a.optInfo.audioName=o.audioName,a.optInfo.audioDesc=o.audioDesc,a.optInfo.audioUrl=o.audioUrl}else T.alert(`Request server fail, tokenId=${this.curId}, code=${m.status}, please try again 1 minute later.`)}catch(m){console.log("showInscription err",m),T.alert(`Request server fail, tokenId=${this.curId}, please try again 1 minute later.`)}finally{this.curInsData.bLoading=!1}},async onClickQueryOwner(){const e=this.curInsData.curInscriptionId;this.curInsData.bInQueryOwner=!0;const i=await N.queryNFTOwner(e);this.curInsData.bInQueryOwner=!1,e==this.curInsData.curInscriptionId&&e==this.curId&&(this.curInsData.owner=i||"")},async onClickOpenMintTx(){const e=this.curInsData.curInscriptionId;this.curInsData.bInQueryMintTx=!0;const i=await A.queryNFTHistory(b.defaultContractAddress,b.inscriptionsContract.name,"inscription",e);this.curInsData.bInQueryMintTx=!1,i&&A.openTxInBrowser(i)}}},I=e=>(q("data-v-472e2a3b"),e=e(),z(),e),J={id:"main"},X={style:{"text-align":"left"}},Y={id:"title"},Z={key:0,"element-loading-background":"rgba(0, 0, 0, 0)",style:{"margin-top":"128px","min-height":"128px"}},$={key:1,style:{"margin-top":"100px"}},tt={id:"previewPayload"},et={key:0,style:{width:"700px"}},nt={key:1},ot=["src","width","height"],at={key:2},st=["src"],it=I(()=>n("p",null,null,-1)),rt=I(()=>n("span",{class:"audioKey"},"Name: ",-1)),ct={key:0},ut=I(()=>n("span",{class:"audioKey"},"Description: ",-1)),lt={key:3},dt={key:2,id:"briefInfoArea"},It=I(()=>n("span",null,"Block: ",-1)),ht=I(()=>n("span",null,"Content type: ",-1)),pt=I(()=>n("span",null,"Content length: ",-1)),gt=I(()=>n("span",null,"Owner: ",-1)),mt=["href"],ft=I(()=>n("span",null,"Mint tx: ",-1));function yt(e,i,l,m,t,f){const h=x("router-link"),w=x("el-space"),d=x("el-input"),s=x("el-button"),v=V("loading");return r(),c("div",J,[n("div",X,[_(w,{alignment:"center"},{default:D(()=>[n("div",Y,"Inscription "+g(t.curId),1),C(_(h,{class:"menua",to:"/inscription/"+(t.curId-1),replace:""},{default:D(()=>[u("❮")]),_:1},8,["to"]),[[j,t.curId>1]]),_(h,{class:"menua",to:"/inscription/"+(t.curId+1),replace:""},{default:D(()=>[u("❯")]),_:1},8,["to"])]),_:1})]),t.curInsData.bLoading?C((r(),c("div",Z,[u("   ")])),[[v,t.curInsData.bLoading]]):p("",!0),!t.curInsData.bLoading&&t.curInsData.block==0?(r(),c("div",$,"Not exist.")):p("",!0),n("div",tt,[!t.curInsData.bLoading&&(t.curInsData.dataType=="text"||t.curInsData.dataType=="deploy-stx10")?(r(),c("div",et,[_(d,{modelValue:t.curInsData.optInfo.text,"onUpdate:modelValue":i[0]||(i[0]=o=>t.curInsData.optInfo.text=o),readonly:"",type:"textarea",autosize:""},null,8,["modelValue"])])):!t.curInsData.bLoading&&t.curInsData.dataType.startsWith("image/")?(r(),c("div",nt,[n("img",{src:t.curInsData.optInfo.imageUrl,width:t.curInsData.optInfo.imageWidth,height:t.kFixImageHeight,class:B({nn:t.curInsData.optInfo.originImageWidth<=64&&t.curInsData.optInfo.originImageHeight<=64&&t.curInsData.optInfo.originImageWidth>0&&t.curInsData.optInfo.originImageHeight>0}),alt:""},null,10,ot)])):!t.curInsData.bLoading&&t.curInsData.dataType.startsWith("audio/")?(r(),c("div",at,[n("audio",{controls:"",src:t.curInsData.optInfo.audioUrl},null,8,st),it,_(w,{direction:"vertical"},{default:D(()=>[n("div",null,[rt,u(" "+g(t.curInsData.optInfo.audioName),1)]),t.curInsData.optInfo.audioDesc.length>0?(r(),c("div",ct,[ut,u(" "+g(t.curInsData.optInfo.audioDesc),1)])):p("",!0)]),_:1})])):!t.curInsData.bLoading&&t.curInsData.block>0?(r(),c("div",lt," Not support preview yet. ")):p("",!0)]),!t.curInsData.bLoading&&t.curInsData.block>0?(r(),c("div",dt,[n("div",null,[It,u(g(t.curInsData.block),1)]),n("div",null,[ht,u(g(t.curInsData.dataType),1)]),n("div",null,[pt,u(" "+g(t.curInsData.dataLength)+" bytes ",1)]),n("div",null,[gt,t.curInsData.owner.length>0?(r(),c("a",{key:0,style:{color:"white"},href:"https://explorer.hiro.so/address/"+t.curInsData.owner+"?chain="+f._inGetNetType(),target:"_blank"},g(t.curInsData.owner),9,mt)):p("",!0),t.curInsData.owner.length==0?(r(),P(s,{key:1,loading:t.curInsData.bInQueryOwner,type:"info",size:"small",onClick:f.onClickQueryOwner},{default:D(()=>[u("Query")]),_:1},8,["loading","onClick"])):p("",!0)]),n("div",null,[ft,_(s,{loading:t.curInsData.bInQueryMintTx,type:"info",size:"small",onClick:f.onClickOpenMintTx},{default:D(()=>[u("Open")]),_:1},8,["loading","onClick"])])])):p("",!0)])}const kt=O(K,[["render",yt],["__scopeId","data-v-472e2a3b"]]);export{kt as default};
