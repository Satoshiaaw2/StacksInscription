import{_ as S,i as O,j as V,u as Q,k as W,U as C,r as H,a as D,l as F,o as r,c,b as t,m as h,t as p,f as u,e as b,w as k,n as B,q as z,s as L,v as P,x as j,p as R,g as q}from"./index-a3b6d68e.js";import{C as T,c as N}from"./ContractHelper-ed65b975.js";import{C as A}from"./ChainHelper-c88ec88a.js";import{f as E}from"./browser-ponyfill-14907c72.js";const G=P(),x=j(),K={name:"DirectMainPage",components:{},data(){return{kFixImageHeight:400,bLoadSummaryFinish:!1,kAudioNameLen:64,kAudioDescLen:64,curId:1,maxId:10,totalAmount:0,curInsData:{bLoading:!1,curInscriptionId:"",block:0,dataType:"",dataLength:"",payload:"",owner:"",bInQueryOwner:!1,bInQueryMintTx:!1,optInfo:{imageUrl:"",imageWidth:"",originImageWidth:0,originImageHeight:0,text:"",audioName:"",audioDesc:"",audioUrl:""}},bNonDSMode:!0}},async mounted(){await this.loadSummary(),this.totalAmount>0&&this.showInscription(this.maxId)},methods:{_inGetNetType(){return O()},async loadSummary(){const i=await T.loadSummary();this.totalAmount=parseInt(i.last_token_id),this.curId=this.maxId=Math.max(this.totalAmount,1),this.bLoadSummaryFinish=!0},async onClickChangeInscriptionId(){this.curId>=1&&this.curId<=this.maxId&&this.showInscription(this.curId)},async showInscription(i){this.curId=i;const s=V(Q(this.curId));try{this.curInsData.bLoading=!0,this.curInsData.bInQueryOwner=!1,this.curInsData.bInQueryMintTx=!1;const f=await E(`${G.coreApiUrl}/v2/map_entry/${x.defaultContractAddress}/${x.inscriptionsContract.name}/map_inscriptions`,{method:"post",headers:{Accept:"application/json","Content-Type":"application/json"},proof:0,body:JSON.stringify(s)});if(f.status==200){const e=await f.json(),y=W(e.data).value.data,w=Number(N(y.block)),l=N(y.type),a=y.payload.buffer,v=a.length;let n={imageUrl:null,text:null},I=!1;if(l.startsWith("image/")){n.imageUrl=window.URL.createObjectURL(new Blob([a],{type:l})),I=!0;var m=new Image;m.src=n.imageUrl;let g=this;m.onload=function(){g.curInsData.bLoading=!1,g.curInsData.optInfo.imageWidth=Math.ceil(m.width*g.kFixImageHeight/m.height),g.curInsData.optInfo.originImageWidth=m.width,g.curInsData.optInfo.originImageHeight=m.height}}else if(l.startsWith("audio/")){const g=a.slice(a.length-this.kAudioNameLen-this.kAudioDescLen,a.length-this.kAudioDescLen);n.audioName=new TextDecoder().decode(g).trim();const U=a.slice(a.length-this.kAudioDescLen);n.audioDesc=new TextDecoder().decode(U).trim();const M=a.slice(0,a.length-this.kAudioNameLen-this.kAudioDescLen);n.audioUrl=window.URL.createObjectURL(new Blob([M],{type:l}))}else(l=="text"||l=="deploy-stx10")&&(n.text=new TextDecoder().decode(y.payload.buffer));I||(this.curInsData.bLoading=!1);let o=this.curInsData;o.curInscriptionId=i,o.block=w,o.dataType=l,o.dataLength=v,o.payload=a,o.owner="",o.bInQueryOwner=!1,o.bInQueryMintTx=!1,o.optInfo.imageUrl=n.imageUrl,o.optInfo.imageWidth=n.imageWidth,o.originImageWidth=n.originImageWidth,o.originImageHeight=n.originImageHeight,o.optInfo.text=n.text,o.optInfo.audioName=n.audioName,o.optInfo.audioDesc=n.audioDesc,o.optInfo.audioUrl=n.audioUrl}else C.alert(`Request server fail, tokenId=${this.curId}, code=${f.status}, please try again 1 minute later.`)}catch{C.alert(`Request server fail, tokenId=${this.curId}, please try again 1 minute later.`)}finally{this.curInsData.bLoading=!1}},async onClickQueryOwner(){const i=this.curInsData.curInscriptionId;this.curInsData.bInQueryOwner=!0;const s=await T.queryNFTOwner(i);this.curInsData.bInQueryOwner=!1,i==this.curInsData.curInscriptionId&&i==this.curId&&(this.curInsData.owner=s||"")},async onClickOpenMintTx(){const i=this.curInsData.curInscriptionId;this.curInsData.bInQueryMintTx=!0;const s=await A.queryNFTHistory(x.defaultContractAddress,x.inscriptionsContract.name,"inscription",i);this.curInsData.bInQueryMintTx=!1,s&&A.openTxInBrowser(s)},onClickLatest(){this.showInscription(this.maxId)},onChangeDSMode(){setTimeout(()=>{H.push({path:"/",replace:!0})},100)}}},d=i=>(R("data-v-7acec260"),i=i(),q(),i),J={id:"main"},X={id:"title"},Y={key:0},Z={key:0,id:"searchArea"},$=d(()=>t("span",{id:"id"},"ID:",-1)),ee={key:1,id:"inscInfoArea"},te={id:"previewPayload"},ne={key:0},oe={key:1},ie=["src","width","height"],se={key:2},ae=["src"],re=d(()=>t("p",null,null,-1)),ce=d(()=>t("span",{class:"audioKey"},"Name: ",-1)),le={key:0},ue=d(()=>t("span",{class:"audioKey"},"Description: ",-1)),de={key:3},Ie={id:"briefInfoArea"},he=d(()=>t("span",null,"Block: ",-1)),pe=d(()=>t("span",null,"Content type: ",-1)),me=d(()=>t("span",null,"Content length: ",-1)),ge=d(()=>t("span",null,"Owner: ",-1)),_e=["href"],ye=d(()=>t("span",null,"Mint tx: ",-1)),fe={key:2,id:"emptyTip"},De={id:"dsArea"};function be(i,s,m,f,e,_){const y=D("el-input-number"),w=D("el-space"),l=D("el-input"),a=D("el-button"),v=D("el-switch"),n=F("loading");return r(),c("div",J,[t("div",X,[h("Total Inscriptions: "),e.bLoadSummaryFinish?(r(),c("span",Y,p(e.totalAmount),1)):u("",!0)]),e.bLoadSummaryFinish&&e.totalAmount>0?(r(),c("div",Z,[b(w,{size:"large"},{default:k(()=>[$,b(y,{modelValue:e.curId,"onUpdate:modelValue":s[0]||(s[0]=I=>e.curId=I),min:1,max:e.maxId,size:"large",onChange:_.onClickChangeInscriptionId,disabled:e.curInsData.bLoading},null,8,["modelValue","max","onChange","disabled"])]),_:1})])):u("",!0),e.totalAmount>0?B((r(),c("fieldset",ee,[t("legend",null,"Inscription #"+p(e.curInsData.curInscriptionId),1),t("div",te,[!e.curInsData.bLoading&&(e.curInsData.dataType=="text"||e.curInsData.dataType=="deploy-stx10")?(r(),c("div",ne,[b(l,{modelValue:e.curInsData.optInfo.text,"onUpdate:modelValue":s[1]||(s[1]=I=>e.curInsData.optInfo.text=I),readonly:"",type:"textarea",autosize:"",resize:"none"},null,8,["modelValue"])])):!e.curInsData.bLoading&&e.curInsData.dataType.startsWith("image/")?(r(),c("div",oe,[t("img",{src:e.curInsData.optInfo.imageUrl,width:e.curInsData.optInfo.imageWidth,height:e.kFixImageHeight,class:z({nn:e.curInsData.optInfo.originImageWidth<=64&&e.curInsData.optInfo.originImageHeight<=64&&e.curInsData.optInfo.originImageWidth>0&&e.curInsData.optInfo.originImageHeight>0}),alt:""},null,10,ie)])):!e.curInsData.bLoading&&e.curInsData.dataType.startsWith("audio/")?(r(),c("div",se,[t("audio",{controls:"",src:e.curInsData.optInfo.audioUrl},null,8,ae),re,b(w,{direction:"vertical"},{default:k(()=>[t("div",null,[ce,h(" "+p(e.curInsData.optInfo.audioName),1)]),e.curInsData.optInfo.audioDesc.length>0?(r(),c("div",le,[ue,h(" "+p(e.curInsData.optInfo.audioDesc),1)])):u("",!0)]),_:1})])):e.curInsData.bLoading?u("",!0):(r(),c("div",de," Not support preview yet. "))]),t("div",Ie,[t("div",null,[he,h(p(e.curInsData.block),1)]),t("div",null,[pe,h(p(e.curInsData.dataType),1)]),t("div",null,[me,h(" "+p(e.curInsData.dataLength)+" bytes ",1)]),t("div",null,[ge,e.curInsData.owner.length>0?(r(),c("a",{key:0,style:{color:"white"},href:"https://explorer.hiro.so/address/"+e.curInsData.owner+"?chain="+_._inGetNetType(),target:"_blank"},p(e.curInsData.owner),9,_e)):u("",!0),e.curInsData.owner.length==0?(r(),L(a,{key:1,loading:e.curInsData.bInQueryOwner,type:"info",size:"small",onClick:_.onClickQueryOwner},{default:k(()=>[h("Query")]),_:1},8,["loading","onClick"])):u("",!0)]),t("div",null,[ye,b(a,{loading:e.curInsData.bInQueryMintTx,type:"info",size:"small",onClick:_.onClickOpenMintTx},{default:k(()=>[h("Open")]),_:1},8,["loading","onClick"])])])])),[[n,e.curInsData.bLoading]]):u("",!0),e.bLoadSummaryFinish&&e.totalAmount==0?(r(),c("div",fe,"No inscription yet")):u("",!0),t("div",De,[e.bLoadSummaryFinish?(r(),L(v,{key:0,modelValue:e.bNonDSMode,"onUpdate:modelValue":s[2]||(s[2]=I=>e.bNonDSMode=I),"active-text":"Non dedicated server","inactive-text":"Dedicated server",onChange:_.onChangeDSMode},null,8,["modelValue","onChange"])):u("",!0)])])}const Ce=S(K,[["render",be],["__scopeId","data-v-7acec260"]]);export{Ce as default};
