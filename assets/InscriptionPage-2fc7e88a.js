import{a as U,i as N,j as O,u as S,k as V,U as v,b as y,l as A,o as a,c as r,d as n,f as _,w as g,n as L,m as l,g as d,t as m,q as Q,s as W,v as B,x as F,p as j,h as H}from"./index-5821ddc0.js";import{C,c as T}from"./ContractHelper-2bcc4442.js";import{f as P}from"./browser-ponyfill-ebc6ff73.js";const R=W(),k=B(),q={name:"InscriptionPage",components:{},data(){return{defaultReadonlyAddress:k.defaultContractAddress,kFixImageHeight:400,bLoadSummaryFinish:!1,curId:1,maxId:10,totalAmount:0,curInsData:{bLoading:!1,curInscriptionId:"",block:0,dataType:"",dataLength:"",payload:"",owner:"",bInQueryOwner:!1,optInfo:{imageUrl:"",imageWidth:"",text:""}}}},watch:{$route(e,s){if(e.path.startsWith("/inscription/")){const i=e.params.id;this.showInscription(i)}}},async mounted(){this.$route.params.hasOwnProperty("id")&&(this.curId=parseInt(this.$route.params.id),!(!this.curId||this.curId<0)&&(this.showInscription(this.curId),this.loadSummary()))},methods:{_inGetNetType(){return N()},async loadSummary(){const e=await C.loadSummary();this.totalAmount=parseInt(e.last_token_id),this.maxId=Math.max(this.totalAmount,1),this.bLoadSummaryFinish=!0},async showInscription(e){this.curId=parseInt(e);const s=O(S(this.curId));try{this.curInsData.bLoading=!0;const I=await P(`${R.coreApiUrl}/v2/map_entry/${k.defaultContractAddress}/${k.inscriptionsContract.name}/map_inscriptions`,{method:"post",headers:{Accept:"application/json","Content-Type":"application/json"},proof:0,body:JSON.stringify(s)});if(I.status==200){const t=await I.json(),p=V(t.data);if(p.type==9){this.curInsData.curInscriptionId=e,this.curInsData.block=0,this.curInsData.dataType="",this.curInsData.dataLength=0,this.curInsData.payload="",this.curInsData.owner="",this.curInsData.bInQueryOwner=!1,this.curInsData.optInfo.imageUrl="",this.curInsData.optInfo.imageWidth=0,this.curInsData.optInfo.text="",this.curInsData.bLoading=!1;return}const c=p.value.data,D=Number(T(c.block)),u=T(c.type),h=c.payload.buffer,b=h.length;let o={imageUrl:null,text:null},x=!1;if(u.startsWith("image/")){o.imageUrl=window.URL.createObjectURL(new Blob([h],{type:u})),x=!0;var i=new Image;i.src=o.imageUrl;let w=this;i.onload=function(){w.curInsData.bLoading=!1,w.curInsData.optInfo.imageWidth=Math.ceil(i.width*w.kFixImageHeight/i.height)}}else(u=="text"||u=="deploy-stx10")&&(o.text=new TextDecoder().decode(c.payload.buffer));x||(this.curInsData.bLoading=!1),this.curInsData.curInscriptionId=e,this.curInsData.block=D,this.curInsData.dataType=u,this.curInsData.dataLength=b,this.curInsData.payload=h,this.curInsData.owner="",this.curInsData.bInQueryOwner=!1,this.curInsData.optInfo.imageUrl=o.imageUrl,this.curInsData.optInfo.imageWidth=o.imageWidth,this.curInsData.optInfo.text=o.text}else v.alert(`Request server fail, tokenId=${this.curId}, code=${I.status}, please try again 1 minute later.`)}catch{v.alert(`Request server fail, tokenId=${this.curId}, please try again 1 minute later.`)}finally{this.curInsData.bLoading=!1}},async onClickQueryOwner(){const e=this.curInsData.curInscriptionId;this.curInsData.bInQueryOwner=!0;const s=await C.queryNFTOwner(e);this.curInsData.bInQueryOwner=!1,e==this.curInsData.curInscriptionId&&e==this.curId&&(this.curInsData.owner=s||"")}}},f=e=>(j("data-v-74e9a73b"),e=e(),H(),e),z={id:"main"},E={style:{"text-align":"left"}},G={id:"title"},M={key:0,"element-loading-background":"rgba(0, 0, 0, 0)",style:{"margin-top":"128px","min-height":"128px"}},J={key:1,style:{"margin-top":"100px"}},K={id:"previewPayload"},X={key:0,style:{width:"700px"}},Y={key:1},Z=["src","width","height"],$={key:2},tt={key:2,id:"briefInfoArea"},et=f(()=>n("span",null,"Block: ",-1)),nt=f(()=>n("span",null,"Content type: ",-1)),at=f(()=>n("span",null,"Content length: ",-1)),st=f(()=>n("span",null,"Owner: ",-1)),ot=["href"];function rt(e,s,i,I,t,p){const c=y("router-link"),D=y("el-space"),u=y("el-input"),h=y("el-button"),b=A("loading");return a(),r("div",z,[n("div",E,[_(D,{alignment:"center"},{default:g(()=>[n("div",G,"Inscription "+m(t.curId),1),L(_(c,{class:"menua",to:"/inscription/"+(t.curId-1),replace:""},{default:g(()=>[l("❮")]),_:1},8,["to"]),[[F,t.curId>1]]),_(c,{class:"menua",to:"/inscription/"+(t.curId+1),replace:""},{default:g(()=>[l("❯")]),_:1},8,["to"])]),_:1})]),t.curInsData.bLoading?L((a(),r("div",M,[l("   ")])),[[b,t.curInsData.bLoading]]):d("",!0),!t.curInsData.bLoading&&t.curInsData.block==0?(a(),r("div",J,"Not exist.")):d("",!0),n("div",K,[!t.curInsData.bLoading&&(t.curInsData.dataType=="text"||t.curInsData.dataType=="deploy-stx10")?(a(),r("div",X,[_(u,{modelValue:t.curInsData.optInfo.text,"onUpdate:modelValue":s[0]||(s[0]=o=>t.curInsData.optInfo.text=o),readonly:"",type:"textarea",autosize:""},null,8,["modelValue"])])):!t.curInsData.bLoading&&t.curInsData.dataType.startsWith("image/")?(a(),r("div",Y,[n("img",{src:t.curInsData.optInfo.imageUrl,width:t.curInsData.optInfo.imageWidth,height:t.kFixImageHeight,alt:""},null,8,Z)])):!t.curInsData.bLoading&&t.curInsData.block>0?(a(),r("div",$," Not support preview yet. ")):d("",!0)]),!t.curInsData.bLoading&&t.curInsData.block>0?(a(),r("div",tt,[n("div",null,[et,l(m(t.curInsData.block),1)]),n("div",null,[nt,l(m(t.curInsData.dataType),1)]),n("div",null,[at,l(" "+m(t.curInsData.dataLength)+" bytes ",1)]),n("div",null,[st,t.curInsData.owner.length>0?(a(),r("a",{key:0,style:{color:"white"},href:"https://explorer.hiro.so/address/"+t.curInsData.owner+"?chain="+p._inGetNetType(),target:"_blank"},m(t.curInsData.owner),9,ot)):d("",!0),t.curInsData.owner.length==0?(a(),Q(h,{key:1,loading:t.curInsData.bInQueryOwner,type:"info",size:"small",onClick:p.onClickQueryOwner},{default:g(()=>[l("Query")]),_:1},8,["loading","onClick"])):d("",!0)])])):d("",!0)])}const lt=U(q,[["render",rt],["__scopeId","data-v-74e9a73b"]]);export{lt as default};
