import{a as S,i as T,j as N,u as V,k as A,U as v,r as U,b as _,l as F,o as s,c as a,d as e,m as y,t as u,g as l,f,w as x,n as M,q as W,s as B,v as O,p as j,h as z}from"./index-3ecd2ce4.js";import{C as k,c as C}from"./ContractHelper-cc5caeb1.js";import{f as H}from"./browser-ponyfill-cb605b94.js";const q=B(),L=O(),P={name:"DirectMainPage",components:{},data(){return{kFixImageHeight:400,bLoadSummaryFinish:!1,curId:1,maxId:10,totalAmount:0,curInsData:{bLoading:!1,curInscriptionId:"",block:0,dataType:"",dataLength:"",payload:"",owner:"",optInfo:{imageUrl:"",imageWidth:"",text:""}},bNonDSMode:!0}},computed:{bShowLatest(){return this.bLoadSummaryFinish&&this.curId<this.maxId}},async mounted(){await this.loadSummary(),this.totalAmount>0&&this.showInscription(this.maxId)},methods:{_inGetNetType(){return T()},async loadSummary(){const n=await k.loadSummary();this.totalAmount=parseInt(n.last_token_id),this.curId=this.maxId=Math.max(this.totalAmount,1),this.bLoadSummaryFinish=!0},async onClickChangeInscriptionId(){this.curId>=1&&this.curId<=this.maxId&&this.showInscription(this.curId)},async showInscription(n){this.curId=n;const o=N(V(this.curId));try{this.curInsData.bLoading=!0;const p=await H(`${q.coreApiUrl}/v2/map_entry/${L.defaultContractAddress}/${L.inscriptionsContract.name}/map_inscriptions`,{method:"post",headers:{Accept:"application/json","Content-Type":"application/json"},proof:0,body:JSON.stringify(o)});if(p.status==200){const t=await p.json(),d=A(t.data).value.data,D=Number(C(d.block)),c=C(d.type),m=d.payload.buffer,b=m.length;let i={imageUrl:null,text:null},r=!1;if(c.startsWith("image/")){i.imageUrl=window.URL.createObjectURL(new Blob([m],{type:c})),r=!0;var h=new Image;h.src=i.imageUrl;let w=this;h.onload=function(){w.curInsData.bLoading=!1,w.curInsData.optInfo.imageWidth=Math.ceil(h.width*w.kFixImageHeight/h.height)}}else(c=="text"||c=="deploy-stx10")&&(i.text=new TextDecoder().decode(d.payload.buffer));r||(this.curInsData.bLoading=!1),this.curInsData.curInscriptionId=n,this.curInsData.block=D,this.curInsData.dataType=c,this.curInsData.dataLength=b,this.curInsData.payload=m,this.curInsData.owner="",this.curInsData.optInfo.imageUrl=i.imageUrl,this.curInsData.optInfo.imageWidth=i.imageWidth,this.curInsData.optInfo.text=i.text}else v.alert(`Request server fail, tokenId=${this.curId}, code=${p.status}, please try again 1 minute later.`)}catch{v.alert(`Request server fail, tokenId=${this.curId}, please try again 1 minute later.`)}finally{this.curInsData.bLoading=!1}},async onClickQueryOwner(){const n=this.curInsData.curInscriptionId,o=await k.queryNFTOwner(n);n==this.curInsData.curInscriptionId&&n==this.curId&&(this.curInsData.owner=o||"")},onClickLatest(){this.showInscription(this.maxId)},onChangeDSMode(){U.push({path:"/",replace:!0})}}},g=n=>(j("data-v-57e08c5b"),n=n(),z(),n),R={id:"main"},Q={id:"title"},E={key:0},G={key:0,id:"searchArea"},J=g(()=>e("span",{id:"id"},"ID:",-1)),K={key:1,id:"inscInfoArea"},X={id:"previewPayload"},Y={key:0},Z={key:1},$=["src","width","height"],tt={key:2},et={id:"briefInfoArea"},nt=g(()=>e("span",null,"Block: ",-1)),ot=g(()=>e("span",null,"Content type: ",-1)),st=g(()=>e("span",null,"Content length: ",-1)),at=g(()=>e("span",null,"Owner: ",-1)),it=["href"],rt={key:2,id:"emptyTip"},ct={id:"dsArea"};function lt(n,o,h,p,t,I){const d=_("el-input-number"),D=_("el-space"),c=_("el-input"),m=_("el-button"),b=_("el-switch"),i=F("loading");return s(),a("div",R,[e("div",Q,[y("Total Inscriptions: "),t.bLoadSummaryFinish?(s(),a("span",E,u(t.totalAmount),1)):l("",!0)]),t.bLoadSummaryFinish&&t.totalAmount>0?(s(),a("div",G,[f(D,{size:"large"},{default:x(()=>[J,f(d,{modelValue:t.curId,"onUpdate:modelValue":o[0]||(o[0]=r=>t.curId=r),min:1,max:t.maxId,size:"large",onChange:I.onClickChangeInscriptionId,disabled:t.curInsData.bLoading},null,8,["modelValue","max","onChange","disabled"])]),_:1})])):l("",!0),t.totalAmount>0?M((s(),a("fieldset",K,[e("legend",null,"Inscription #"+u(t.curInsData.curInscriptionId),1),e("div",X,[!t.curInsData.bLoading&&(t.curInsData.dataType=="text"||t.curInsData.dataType=="deploy-stx10")?(s(),a("div",Y,[f(c,{modelValue:t.curInsData.optInfo.text,"onUpdate:modelValue":o[1]||(o[1]=r=>t.curInsData.optInfo.text=r),readonly:"",type:"textarea",autosize:"",resize:"none"},null,8,["modelValue"])])):!t.curInsData.bLoading&&t.curInsData.dataType.startsWith("image/")?(s(),a("div",Z,[e("img",{src:t.curInsData.optInfo.imageUrl,width:t.curInsData.optInfo.imageWidth,height:t.kFixImageHeight,alt:""},null,8,$)])):t.curInsData.bLoading?l("",!0):(s(),a("div",tt," Not support preview yet. "))]),e("div",et,[e("div",null,[nt,y(u(t.curInsData.block),1)]),e("div",null,[ot,y(u(t.curInsData.dataType),1)]),e("div",null,[st,y(" "+u(t.curInsData.dataLength)+" bytes ",1)]),e("div",null,[at,t.curInsData.owner.length>0?(s(),a("a",{key:0,style:{color:"white"},href:"https://explorer.hiro.so/address/"+t.curInsData.owner+"?chain="+I._inGetNetType(),target:"_blank"},u(t.curInsData.owner),9,it)):l("",!0),t.curInsData.owner.length==0?(s(),W(m,{key:1,type:"info",size:"small",onClick:I.onClickQueryOwner},{default:x(()=>[y("Query")]),_:1},8,["onClick"])):l("",!0)])])])),[[i,t.curInsData.bLoading]]):l("",!0),t.bLoadSummaryFinish&&t.totalAmount==0?(s(),a("div",rt,"No inscription yet")):l("",!0),e("div",ct,[f(b,{modelValue:t.bNonDSMode,"onUpdate:modelValue":o[2]||(o[2]=r=>t.bNonDSMode=r),"active-text":"Non dedicate server","inactive-text":"Dedicate server",onChange:I.onChangeDSMode},null,8,["modelValue","onChange"])])])}const pt=S(P,[["render",lt],["__scopeId","data-v-57e08c5b"]]);export{pt as default};
