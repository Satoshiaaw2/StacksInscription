import{_ as z,K as _,a7 as U,a8 as E,a9 as H,a6 as O,c as D,o as V,b as e,a as j,d as o,t as f,w as r,h as g,g as G,aa as J,e as K,i as Y,r as Z,M as W,Z as tt,L as et,m as st,J as nt,I as at,D as N,p as S,ab as m,ac as ot,F as P,u as A,H as F,ad as lt,C as it,q as rt,s as dt,z as ct}from"./index-Cc1XKo18.js";/* empty css                   *//* empty css                        *//* empty css                  *//* empty css                */const ut={class:"textindexer-page"},pt={class:"container"},vt={class:"stats-section glass-effect"},ft={class:"stats-grid"},_t={class:"stat-card"},mt={class:"stat-value"},ht={class:"stat-card"},gt={class:"stat-value-with-button"},xt={class:"stat-value"},yt={class:"stat-card"},bt={class:"stat-value-with-button"},It={class:"stat-value"},wt={class:"query-section glass-effect"},Ct={class:"query-input-section"},kt={class:"query-actions"},Tt={key:0,class:"results-section"},qt={class:"results-grid"},Et={class:"result-column"},Dt={class:"result-header found-header"},Vt={class:"result-count"},Nt={class:"result-table-container glass-effect"},St={class:"content-cell"},Pt={class:"result-column"},At={class:"result-header not-found-header"},Ft={class:"result-count"},Lt={class:"result-table-container glass-effect"},Mt={class:"content-cell not-found-content"},Bt={class:"success-content"},Rt=["href"],$t={__name:"TextIndexerPage",setup(Qt){const b=at(),c=nt(),L=new TextEncoder,x=_(!1),C=_(!1),u=_(""),y=_(!1),h=_(""),l=_({latestInscription:-1,indexToInscription:-1,rewardPool:-1}),I=_([]),w=_([]);U(()=>{T(),setInterval(()=>{T()},2e4)});const k=E(()=>{if(!u.value.trim())return!1;const s=u.value.split(`
`).filter(t=>L.encode(t.trim()));return s.length===0||s.length>25?!1:s.every(t=>t.length<=128)});E(()=>u.value.split(`
`).filter(s=>s.trim()).length);const M=()=>{const s=u.value.split(`
`);if(s.length>25){const n=s.slice(0,25);u.value=n.join(`
`),m.warning("Maximum 25 lines allowed")}const t=s.map(n=>n.length>128?(m.warning("Line exceeds 128 characters limit"),n.slice(0,128)):n);u.value=t.join(`
`)},T=async()=>{const s={contractAddress:c.indexerContract.address,contractName:c.indexerContract.name,functionName:"get_summary",functionArgs:[],network:b,senderAddress:c.indexerContract.address},t=await H(s),n=O(t);l.value.latestInscription=parseInt(n.latest_token_id.value),l.value.indexToInscription=parseInt(n.last_synced_token_id.value),l.value.rewardPool=parseInt(n.balance.value)},B=async()=>{if(!k.value){m.error("Please enter valid query items");return}try{const s=u.value.split(`
`).filter(a=>a.trim());let t={},n=[];for(const a of s)a.length>0&&!(a in t)&&(t[a]=!0,n.push(a));x.value=!0;const p=await it.queryIndexer(n);if(!p){m.error("Query failed"),x.value=!1;return}const v=[],i=[];for(const a of p)a.tokenId>0?v.push({inscriptionId:a.tokenId,content:a.content}):i.push({content:a.content});I.value=v,w.value=i,C.value=!0,m.success(`Query completed: ${v.length} found, ${i.length} not found`)}catch{m.error("Query failed")}finally{x.value=!1}},R=()=>{if(!N.isUserSignedIn()){S();return}const s=l.value.latestInscription-l.value.indexToInscription;if(s<=0){m.info("Not need drive.");return}let t=0;s>200?t=400:s>100?t=200:s>50?t=100:s>1?t=50:t=1;let n=null;t==1?n="drive":n=`drive_${t}`;let p=[];p.push(ot(c.indexerContract.address,c.indexerContract.name,P.GreaterEqual,0n));let v=[];const i={contractAddress:c.indexerContract.address,contractName:c.indexerContract.name,functionName:n,functionArgs:v,network:b,appDetails:F(),postConditions:p,onFinish:a=>{h.value=a.txId,y.value=!0}};A(i)},$=async()=>{if(!N.isUserSignedIn()){S();return}try{const{value:s}=await lt.prompt("Input the amount(STX) you'd like to donate:","Donate",{confirmButtonText:"Ok",cancelButtonText:"Cancel",inputPattern:/^[0-9|\.]{1,}$/,inputErrorMessage:"Invalid amount",autofocus:!0}),t=Number(s);if(t<.01||t>1e3){m.error("Invalid value(should be [0.01, 1000])");return}Q(Math.floor(t*1e6))}catch(s){console.log("handleDonate error: ",s);return}},Q=s=>{console.log("sureDonate ",s);let t=[];t.push(rt(dt(),P.Equal,s));const n=[ct(s)],p={contractAddress:c.indexerContract.address,contractName:c.indexerContract.name,functionName:"donate",functionArgs:n,network:b,appDetails:F(),postConditions:t,onFinish:v=>{h.value=v.txId,y.value=!0}};A(p)};return(s,t)=>{const n=G,p=Z("Search"),v=Y,i=W,a=tt,q=et,X=st;return V(),D("div",ut,[e("div",pt,[t[13]||(t[13]=e("div",{class:"page-header"},[e("h2",{class:"page-title neon-text"},"On-chain first-is-first text indexer")],-1)),e("div",vt,[e("div",ft,[e("div",_t,[t[2]||(t[2]=e("div",{class:"stat-label"},"Latest inscription",-1)),e("div",mt,f(l.value.latestInscription>0?l.value.latestInscription:"-"),1)]),e("div",ht,[t[4]||(t[4]=e("div",{class:"stat-label"},"Index-to inscription",-1)),e("div",gt,[e("span",xt,f(l.value.indexToInscription>0?l.value.indexToInscription:"-"),1),o(n,{onClick:R,type:"primary",size:"small",class:"action-btn drive-btn"},{default:r(()=>t[3]||(t[3]=[g(" Drive ")])),_:1,__:[3]})])]),e("div",yt,[t[6]||(t[6]=e("div",{class:"stat-label"},"Reward pool",-1)),e("div",bt,[e("span",It,f(l.value.rewardPool>0?l.value.rewardPool/1e6+" STX":"-"),1),o(n,{onClick:$,type:"warning",size:"small",class:"action-btn donate-btn"},{default:r(()=>t[5]||(t[5]=[g(" Donate ")])),_:1,__:[5]})])])])]),e("div",wt,[t[8]||(t[8]=e("div",{class:"query-header"},[e("p",{class:"query-instructions"}," Input query items (max 25 items, max 128 characters per item): ")],-1)),e("div",Ct,[o(J(K),{modelValue:u.value,"onUpdate:modelValue":t[0]||(t[0]=d=>u.value=d),type:"textarea",rows:12,placeholder:"Enter your query items here... (one per line, max 25 lines)",class:"query-textarea",maxlength:25*128,"show-word-limit":"",onInput:M},null,8,["modelValue"]),e("div",kt,[o(n,{onClick:B,type:"primary",size:"large",class:"query-many-btn cyber-glow",loading:x.value,disabled:!k.value},{default:r(()=>[o(v,null,{default:r(()=>[o(p)]),_:1}),t[7]||(t[7]=g(" Query many "))]),_:1,__:[7]},8,["loading","disabled"])])])]),C.value?(V(),D("div",Tt,[e("div",qt,[e("div",Et,[e("div",Dt,[t[9]||(t[9]=e("h3",null,"Found",-1)),e("span",Vt,f(I.value.length)+" items",1)]),e("div",Nt,[o(q,{data:I.value,class:"cyber-table found-table",height:"400",style:{width:"100%"}},{default:r(()=>[o(i,{label:"Index",width:"80",type:"index"}),o(i,{label:"Content","min-width":"160"},{default:r(d=>[e("div",St,f(d.row.content),1)]),_:1}),o(i,{label:"Inscription #",width:"150"},{default:r(d=>[o(a,{href:`#/detail/${d.row.inscriptionId}`,target:"_blank",type:"primary",class:"inscription-link"},{default:r(()=>[g(" #"+f(d.row.inscriptionId),1)]),_:2},1032,["href"])]),_:1})]),_:1},8,["data"])])]),e("div",Pt,[e("div",At,[t[10]||(t[10]=e("h3",null,"Not found",-1)),e("span",Ft,f(w.value.length)+" items",1)]),e("div",Lt,[o(q,{data:w.value,class:"cyber-table not-found-table",height:"400",style:{width:"100%"}},{default:r(()=>[o(i,{label:"Index",width:"80",type:"index"}),o(i,{label:"Content","min-width":"250"},{default:r(d=>[e("div",Mt,f(d.row.content),1)]),_:1})]),_:1},8,["data"])])])])])):j("",!0),o(X,{modelValue:y.value,"onUpdate:modelValue":t[1]||(t[1]=d=>y.value=d),title:"Transaction Successful",width:"420px",class:"success-dialog"},{default:r(()=>[e("div",Bt,[t[12]||(t[12]=e("p",null,"Your transaction has been submitted successfully!",-1)),e("p",null,[t[11]||(t[11]=g(" View transaction: ")),e("a",{href:`https://explorer.hiro.so/txid/0x${h.value}?chain=mainnet`,target:"_blank",class:"tx-link"},"0x"+f(h.value.substring(0,5)+"..."+h.value.substring(h.value.length-4)),9,Rt)])])]),_:1},8,["modelValue"]),t[14]||(t[14]=e("div",{class:"indexer-animations"},[e("div",{class:"floating-text text-1"},"INDEX"),e("div",{class:"floating-text text-2"},"SEARCH")],-1))])])}}},jt=z($t,[["__scopeId","data-v-f379e0b3"]]);export{jt as default};
