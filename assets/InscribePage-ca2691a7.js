import{_ as R,u as M,s as N,E,v as m,x as B,a as y,y as x,F as q,z as P,r as f,o as d,d as g,j as r,w as o,e as I,i as u,t as L,f as p,l as S,p as D,q as X,A as j,g as H,m as O,n as Q}from"./index-88f05315.js";import{b as W,F as A,C as T,m as G}from"./ContractHelper-06a52c12.js";import{C as J}from"./ChainHelper-4787de2a.js";import{U as i}from"./utils-bf7ba3cc.js";window.Buffer=window.Buffer||W.Buffer;const K=O(),U=Q(),Y={name:"InscribePage",components:{},data(){return{bSignedIn:M.isUserSignedIn(),kMaxBuffLen:1022976,tips:{kQueryFail:"Query fail, please retry later.",kTickAlreadyExists:"Tick already exists.",kTickNotExists:"Tick doesn't exists yet, need deploy first.",kReceiverIsSelf:"Receiver cann't be equal with current login address!",kTickInvalidAmt:"Invalid amt",kInscribeTransactionTip:"Inscribe transaction has been sent.",kTooMuchFeeTip:"Transaction fee maybe very high, need adjust it manually!"},activeTabName:"SINS",burnConfig:{default:5e4,deploySRC20:15e6},src20Info:{action:"mint",tick:"",max:"",lim:"",amt:"",receiver:""},sinsInfo:{name:"",namespace:""},imageInfo:{bLoadImageSucceed:!1,fileType:"",imageUrl:"",width:1,height:1},needBurnStx:5e4,textarea:"",fileName:""}},computed:{inscribeBtnValid(){if(this.activeTabName=="SINS")return/^[0-9|a-z|_|-]{1,48}$/i.test(i.trimLower(this.sinsInfo.name))&&/^[0-9|a-z|_|-]{1,20}$/i.test(i.trimLower(this.sinsInfo.namespace));if(this.activeTabName=="Text")return this.textarea.trim().length>0;if(this.activeTabName=="src-20"){if(this.src20Info.action=="mint")return/^[a-z]{2,16}$/i.test(i.trimLower(this.src20Info.tick))&&/^[0-9]{1,}$/.test(this.src20Info.amt.trim())&&parseInt(this.src20Info.amt.trim())>0;if(this.src20Info.action=="transfer")return/^[a-z]{2,16}$/i.test(i.trimLower(this.src20Info.tick))&&/^[0-9]{1,}$/.test(this.src20Info.amt.trim())&&parseInt(this.src20Info.amt.trim())>0&&i.parseAddress(this.src20Info.receiver)!=null;if(this.src20Info.action=="deploy")return/^[a-z]{2,16}$/i.test(i.trimLower(this.src20Info.tick))&&/^[0-9]{1,17}$/.test(this.src20Info.max.trim())&&parseInt(this.src20Info.max.trim())>0&&/^[0-9]{1,13}$/.test(this.src20Info.lim.trim())&&parseInt(this.src20Info.lim.trim())>0}else if(this.activeTabName=="Image")return this.imageInfo.bLoadImageSucceed;return!1}},async mounted(){},methods:{updateBurnFee(){this.activeTabName!="src-20"?this.needBurnStx=this.burnConfig.default:this.src20Info.action=="mint"?this.needBurnStx=this.burnConfig.default:this.src20Info.action=="transfer"?this.needBurnStx=0:this.src20Info.action=="deploy"&&(this.needBurnStx=this.burnConfig.deploySRC20)},readFile(){let n=this;const t=this.$refs.image.files[0];n.imageInfo.bLoadImageSucceed=!1,A.fromBlob(t).then(s=>{if(!s||!s.mime||!s.mime.startsWith("image/")){n.imageInfo.fileType="none";return}n.imageInfo.fileType=s.mime,n.imageInfo.imageUrl=window.URL.createObjectURL(t);var a=new Image;a.src=n.imageInfo.imageUrl,a.onload=function(){n.imageInfo.bLoadImageSucceed=!0;const e=200;n.imageInfo.width=Math.ceil(a.width*e/a.height),n.imageInfo.height=e}},s=>{i.alert("Error: fromBlob error")})},onClickInscribe(){if(!this.bSignedIn){N();return}const n=E.service({lock:!0,background:"rgba(0, 0, 0, 0.6)"});try{this.activeTabName=="SINS"?this.inscribeSINS():this.activeTabName=="Text"?this.inscribeText():this.activeTabName=="src-20"?this.inscribeSRC20():this.activeTabName=="Image"&&this.inscribeImage()}finally{n.close()}},async inscribeSINS(){this.sinsInfo.name=i.trimLower(this.sinsInfo.name).toLowerCase(),this.sinsInfo.namespace=i.trimLower(this.sinsInfo.namespace);const n=this.sinsInfo.name,t=this.sinsInfo.namespace;if(n.length<=0||t.length<=0)return;const s=await T.resolveSINSName(n,t);if(s.tokenId!=0){i.alert(`${n}.${t} has already been registered, belongs to ${s.address}`);return}const a=[m(`{"p":"sins","op":"reg","name":"${n}.${t}"}`),m(n),m(t)];this.requestInscribe("inscribe_sins",a)},inscribeText(){const n=this.textarea.trim();if(n.length<=0)return;if(n.length>this.kMaxBuffLen){i.alert(`Max ${this.kMaxBuffLen} bytes(${this.kMaxBuffLen/1024}k), current ${n.length} bytes(${Math.floor(n.length/1024)}k).`);return}var t=new TextEncoder().encode(n);const s=[B(t)];this.requestInscribe("inscribe_text",s)},async inscribeSRC20(){const n=i.trimLower(this.src20Info.tick);this.src20Info.tick=n;const t=await T.resolveSRC20InfoByTick(n);if(!t){i.alert(this.tips.kQueryFail);return}if(this.src20Info.action=="mint"){if(t.block==0){i.alert(this.tips.kTickNotExists);return}if(t.apply==t.max){i.alert("Tick has been minted out!");return}const s=BigInt(this.src20Info.amt),a=t.max-t.supply,e=t.lim<a?t.lim:a;if(s<=0||s>e){e>1?i.alert(`Invalid amt, should from 1 to ${e}`):i.alert("Invalid amt, should be 1");return}const c=[m(`{"p":"src-20","op":"mint","tick":"${n}","amt":"${s}"}`),m(n),y(s)];this.requestInscribe("inscribe_mint_src20",c)}else if(this.src20Info.action=="transfer"){if(this.src20Info.receiver=this.src20Info.receiver.trim(),t.block==0){i.alert(this.tips.kTickNotExists);return}const s=BigInt(this.src20Info.amt);if(s<=0){i.alert(this.tips.kTickInvalidAmt);return}const a=await T.loadSRC20Balance(n,x());if(s>a){i.alert(`amt exceeds balance(${a})`);return}if(this.src20Info.receiver.toLocaleLowerCase()==x().toLocaleLowerCase()){i.alert(this.tips.kReceiverIsSelf);return}const e=i.parseAddress(this.src20Info.receiver);if(!e){i.alert("Invalid receiver");return}const c=[m(`{"p":"src-20","op":"transfer","tick":"${n}","amt":"${s}"}`),e,m(n),y(s)];this.requestInscribe("inscribe_transfer_src20",c)}else if(this.src20Info.action=="deploy"){if(await J.getAccountBalance(x())<=this.burnConfig.deploySRC20+1e4){i.alert(`Need burn ${this.burnConfig.deploySRC20/1e6} STX, balance not enough!`);return}if(t.block!=0){i.alert(this.tips.kTickAlreadyExists);return}const a=BigInt(this.src20Info.max);if(a<=0||a>10000000000000000n){i.alert("max should between 1-10000000000000000");return}const e=BigInt(this.src20Info.lim);if(e<=0){i.alert("Invalid lim");return}if(a/e<20000n){i.alert(`max/lim should >= 20000, currently max(${a})/lim(${e}) is ${a/e}.`);return}const c=[m(`{"p":"src-20","op":"deploy","tick":"${n}","max":"${a}","lim":"${e}"}`),m(n),y(a),y(e)];this.requestInscribe("inscribe_deploy_src20",c)}},async inscribeImage(){const n=this.$refs.image.files[0];A.fromBlob(n).then(t=>{if(!t||!t.mime){alert("Invalid image");return}const s=new FileReader;let a=this;s.onload=async function(){var e=new Uint8Array(s.result);if(e.length>1022976){i.alert(`Max 1022976 bytes(999k), current image is ${e.length} bytes(${Math.floor(e.length/1024)}k).`);return}const c=[m(t.mime),B(e)];a.requestInscribe("inscribe_misc",c)},s.readAsArrayBuffer(n)},t=>{alert("From fromBlob error")})},async requestInscribe(n,t){let s=[];this.needBurnStx>0&&s.push(G(x(),q.LessEqual,this.needBurnStx));const a={contractAddress:U.defaultContractAddress,contractName:U.inscriptionsContract.name,functionName:n,functionArgs:t,network:K,appDetails:j(),postConditions:s,onFinish:e=>{i.alert(this.tips.kInscribeTransactionTip+` <a style="color:white" href="https://explorer.hiro.so/txid/${e.txId}?chain=${H()}" target="_blank">Visit transaction.</a>`)}};P(a)},onClickSignIn(){N()},onClickTest(){}}},C=n=>(D("data-v-14be17c4"),n=n(),X(),n),Z={id:"main"},$=C(()=>I("div",{id:"title"},"Inscribe",-1)),ee={id:"chooseFile",class:"tabInner"},te=["disabled"],ne={key:0,id:"imagePreview"},ie=["src","width","height"],se={id:"inscribeArea"},re={key:0},ae={key:1,id:"burnTip"},oe={key:2},le={key:3,id:"imageWarn"},ce=C(()=>I("legend",null,"Warning",-1)),me=C(()=>I("div",null,"1. Image size limit is 999k, but Leather/Xverse wallet may not respond when size is bigger than 500k.",-1)),de={id:"red"};function fe(n,t,s,a,e,c){const h=f("el-input"),_=f("el-col"),b=f("el-form-item"),w=f("el-form"),k=f("el-tab-pane"),v=f("el-radio"),z=f("el-radio-group"),F=f("el-tabs"),V=f("el-button");return d(),g("div",Z,[$,r(F,{modelValue:e.activeTabName,"onUpdate:modelValue":t[10]||(t[10]=l=>e.activeTabName=l),size:"large",onTabChange:c.updateBurnFee},{default:o(()=>[r(k,{label:"SINS",name:"SINS"},{default:o(()=>[r(w,{model:e.sinsInfo,"label-width":"120px",class:"tabInner",size:"large",disabled:!e.bSignedIn},{default:o(()=>[r(b,{label:"Name"},{default:o(()=>[r(_,{span:12},{default:o(()=>[r(h,{modelValue:e.sinsInfo.name,"onUpdate:modelValue":t[0]||(t[0]=l=>e.sinsInfo.name=l),placeholder:""},null,8,["modelValue"])]),_:1}),r(_,{span:12},{default:o(()=>[p(" Only contains 0-9,a-z,-,_, max 48 charecters. ")]),_:1})]),_:1}),r(b,{label:"Namespace"},{default:o(()=>[r(_,{span:12},{default:o(()=>[r(h,{modelValue:e.sinsInfo.namespace,"onUpdate:modelValue":t[1]||(t[1]=l=>e.sinsInfo.namespace=l),placeholder:""},null,8,["modelValue"])]),_:1}),r(_,{span:12},{default:o(()=>[p(" Only contains 0-9,a-z,-,_, max 20 charecters. ")]),_:1})]),_:1})]),_:1},8,["model","disabled"])]),_:1}),r(k,{label:"Text",name:"Text"},{default:o(()=>[r(h,{class:"tabInner",disabled:!e.bSignedIn,modelValue:e.textarea,"onUpdate:modelValue":t[2]||(t[2]=l=>e.textarea=l),rows:10,type:"textarea",placeholder:"content"},null,8,["disabled","modelValue"])]),_:1}),r(k,{label:"src-20",name:"src-20"},{default:o(()=>[r(z,{modelValue:e.src20Info.action,"onUpdate:modelValue":t[3]||(t[3]=l=>e.src20Info.action=l),class:"tabInner",disabled:!e.bSignedIn,onChange:c.updateBurnFee},{default:o(()=>[r(v,{label:"mint",size:"large"},{default:o(()=>[p("Mint")]),_:1}),r(v,{label:"transfer",size:"large"},{default:o(()=>[p("Transfer")]),_:1}),r(v,{label:"deploy",size:"large"},{default:o(()=>[p("Deploy")]),_:1})]),_:1},8,["modelValue","disabled","onChange"]),r(w,{model:e.src20Info,"label-width":"120px",class:"tabInner",size:"large",disabled:!e.bSignedIn},{default:o(()=>[r(b,{label:"tick"},{default:o(()=>[r(h,{modelValue:e.src20Info.tick,"onUpdate:modelValue":t[4]||(t[4]=l=>e.src20Info.tick=l),placeholder:"a-z, length from 2 to 16",maxlength:"16"},null,8,["modelValue"])]),_:1}),e.src20Info.action=="deploy"?(d(),S(b,{key:0,label:"max"},{default:o(()=>[r(h,{modelValue:e.src20Info.max,"onUpdate:modelValue":t[5]||(t[5]=l=>e.src20Info.max=l),placeholder:"",maxlength:"17"},null,8,["modelValue"])]),_:1})):u("",!0),e.src20Info.action=="deploy"?(d(),S(b,{key:1,label:"lim"},{default:o(()=>[r(h,{modelValue:e.src20Info.lim,"onUpdate:modelValue":t[6]||(t[6]=l=>e.src20Info.lim=l),placeholder:"",maxlength:"13"},null,8,["modelValue"])]),_:1})):u("",!0),e.src20Info.action!="deploy"?(d(),S(b,{key:2,label:"amt"},{default:o(()=>[r(h,{modelValue:e.src20Info.amt,"onUpdate:modelValue":t[7]||(t[7]=l=>e.src20Info.amt=l),placeholder:""},null,8,["modelValue"])]),_:1})):u("",!0),e.src20Info.action=="transfer"?(d(),S(b,{key:3,label:"receiver"},{default:o(()=>[r(h,{modelValue:e.src20Info.receiver,"onUpdate:modelValue":t[8]||(t[8]=l=>e.src20Info.receiver=l),placeholder:""},null,8,["modelValue"])]),_:1})):u("",!0)]),_:1},8,["model","disabled"])]),_:1}),r(k,{label:"Image",name:"Image"},{default:o(()=>[I("div",ee,[I("input",{disabled:!e.bSignedIn,type:"file",ref:"image",onChange:t[9]||(t[9]=l=>c.readFile())},null,40,te),e.imageInfo.bLoadImageSucceed?(d(),g("div",ne,[I("img",{src:e.imageInfo.imageUrl,width:e.imageInfo.width,height:e.imageInfo.height,alt:""},null,8,ie)])):u("",!0)])]),_:1})]),_:1},8,["modelValue","onTabChange"]),I("div",se,[e.bSignedIn?(d(),g("div",re,[r(V,{disabled:!c.inscribeBtnValid,type:"primary",size:"large",round:"",onClick:c.onClickInscribe},{default:o(()=>[p("Inscribe")]),_:1},8,["disabled","onClick"])])):u("",!0),e.bSignedIn&&e.needBurnStx>0?(d(),g("div",ae,"Need burn: "+L(e.needBurnStx/1e6)+" STX",1)):u("",!0),e.bSignedIn?u("",!0):(d(),g("div",oe,[r(V,{type:"primary",size:"large",round:"",onClick:c.onClickSignIn},{default:o(()=>[p("Sign in to inscribe")]),_:1},8,["onClick"])])),e.activeTabName=="Image"&&c.inscribeBtnValid?(d(),g("fieldset",le,[ce,me,I("div",de,"2. "+L(e.tips.kTooMuchFeeTip),1)])):u("",!0)])])}const pe=R(Y,[["render",fe],["__scopeId","data-v-14be17c4"]]);export{pe as default};
