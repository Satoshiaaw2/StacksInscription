import{_ as W,c as d,o as i,b as s,d as h,w as y,i as H,r as L,g as M,t as u,a as D,n as R,h as v,ae as B,R as T,af as x,J as E,C as A,a4 as P,z as S,I as V,a5 as q,a6 as N,U as O}from"./index-Cc1XKo18.js";/* empty css                         */import{C as U}from"./ChainHelper-B-epty4G.js";import{f as z}from"./browser-ponyfill-BqIaopFE.js";const j=V(),b=E(),F={name:"InscriptionPage",components:{},data(){return{defaultReadonlyAddress:b.defaultContractAddress,kFixImageHeight:400,kAudioNameLen:64,kAudioDescLen:64,curId:1,maxId:10,totalAmount:0,curInsData:{bLoading:!1,curInscriptionId:"",block:0,dataType:"",dataLength:"",payload:"",owner:"",bInQueryOwner:!1,bInQueryMintTx:!1,optInfo:{imageUrl:"",imageWidth:"",originImageWidth:0,originImageHeight:0,text:"",audioName:"",audioDesc:"",audioUrl:""}}}},watch:{$route(n,e){if(n.path.startsWith("/detail/")){const r=n.params.id;this.showInscription(r)}}},async mounted(){this.$route.params.hasOwnProperty("id")&&(this.curId=parseInt(this.$route.params.id),this.curId&&this.curId>0?(this.showInscription(this.curId),this.loadSummary()):(await this.loadSummary(),this.curId=this.maxId,this.showInscription(this.curId)))},methods:{async loadSummary(){const n=await A.loadSummary();this.totalAmount=parseInt(n.last_token_id),this.maxId=Math.max(this.totalAmount,1)},async showInscription(n){this.curId=parseInt(n);const e=P(S(this.curId));try{let o=this.curInsData;o.bLoading=!0,o.block="",o.dataType="",o.dataLength="",o.payload="",o.owner="",o.optInfo={};const t=await z(`${j.coreApiUrl}/v2/map_entry/${b.defaultContractAddress}/${b.inscriptionsContract.name}/map_inscriptions`,{method:"post",headers:{Accept:"application/json","Content-Type":"application/json"},proof:0,body:JSON.stringify(e)});if(t.status==200){const m=await t.json(),w=q(m.data);if(w.type==9){this.curInsData.curInscriptionId=n,this.curInsData.block=0,this.curInsData.dataType="",this.curInsData.dataLength=0,this.curInsData.payload="",this.curInsData.owner="",this.curInsData.bInQueryOwner=!1,this.curInsData.bInQueryMintTx=!1,this.curInsData.optInfo.imageUrl="",this.curInsData.optInfo.imageWidth=0,this.curInsData.optInfo.originImageWidth=0,this.curInsData.optInfo.originImageHeight=0,this.curInsData.optInfo.text="",this.curInsData.bLoading=!1;return}const I=w.value.data,g=Number(N(I.block)),c=N(I.type),a=I.payload.buffer,_=a.length;let p={imageUrl:null,text:null},C=!1;if(c.startsWith("image/")){p.imageUrl=window.URL.createObjectURL(new Blob([a],{type:c})),C=!0;var r=new Image;r.src=p.imageUrl;let k=this;r.onload=function(){let f=k.curInsData;f.bLoading=!1,f.optInfo.imageWidth=Math.ceil(r.width*k.kFixImageHeight/r.height),f.optInfo.originImageWidth=r.width,f.optInfo.originImageHeight=r.height}}else if(c.startsWith("audio/")){const k=a.slice(a.length-this.kAudioNameLen-this.kAudioDescLen,a.length-this.kAudioDescLen);p.audioName=new TextDecoder().decode(k).trim();const f=a.slice(a.length-this.kAudioDescLen);p.audioDesc=new TextDecoder().decode(f).trim();const Q=a.slice(0,a.length-this.kAudioNameLen-this.kAudioDescLen);p.audioUrl=window.URL.createObjectURL(new Blob([Q],{type:c}))}else(c=="text"||c=="deploy-stx10")&&(p.text=new TextDecoder().decode(I.payload.buffer));C||(this.curInsData.bLoading=!1);let l=this.curInsData;l.curInscriptionId=n,l.block=g,l.dataType=c,l.dataLength=_,l.payload=a,l.owner="",l.bInQueryOwner=!1,l.bInQueryMintTx=!1,l.optInfo=p}else O.alert(`Request server fail, tokenId=${this.curId}, code=${t.status}, please try again 1 minute later.`)}catch(o){console.log("showInscription err",o),O.alert(`Request server fail, tokenId=${this.curId}, please try again 1 minute later.`)}finally{this.curInsData.bLoading=!1}},async onClickQueryOwner(){const n=this.curInsData.curInscriptionId;this.curInsData.bInQueryOwner=!0;const e=await A.queryNFTOwner(n);this.curInsData.bInQueryOwner=!1,n==this.curInsData.curInscriptionId&&n==this.curId&&(this.curInsData.owner=e||"")},async onClickOpenMintTx(){const n=this.curInsData.curInscriptionId;this.curInsData.bInQueryMintTx=!0;const e=await U.queryNFTHistory(b.defaultContractAddress,b.inscriptionsContract.name,"inscription",n);this.curInsData.bInQueryMintTx=!1,e&&U.openTxInBrowser(e)},onClickPrevious(){const n=this.curId-1;n>=1&&(console.log("___prevId: ",n),x.push(`/detail/${n}`))},onClickNext(){const n=this.curId+1;n<=this.maxId&&x.push(`/detail/${n}`)},onClickToEnd(){x.push(`/detail/${this.maxId}`)}}},J={class:"detail-page"},Y={class:"container"},G={class:"page-header"},K={class:"inscription-nav"},X={class:"inscription-title neon-text"},Z={class:"content-area"},$={class:"content-section glass-effect"},tt={key:0,class:"content-display text-content"},st={class:"text-container"},et={class:"text-content-pre"},nt={key:1,class:"content-display image-content"},at={class:"image-container"},ot=["src","alt","width","height"],it={key:2,class:"content-display audio-content"},rt={class:"audio-container"},ct={class:"audio-title"},lt={controls:"",class:"audio-player"},dt=["src"],ut={key:3,class:"loading-content"},It={class:"stats-section glass-effect"},pt={class:"stats-grid"},ht={key:0,class:"stat-item"},mt={class:"stat-value"},gt={class:"stat-item"},ft={class:"stat-value"},yt={class:"stat-item"},_t={class:"stat-value"},Dt={class:"stat-item"},bt={key:0,class:"stat-value"},wt={class:"stat-item"},kt={class:"stat-value"},vt=["href"],xt={class:"stat-item"},Ct={class:"stat-value"};function Lt(n,e,r,o,t,m){const w=L("ArrowLeft"),I=H,g=M,c=L("ArrowRight"),a=B;return i(),d("div",J,[s("div",Y,[s("div",G,[s("div",K,[h(g,{onClick:m.onClickPrevious,circle:"",type:"primary",class:"nav-btn prev-btn",disabled:t.curId<=1},{default:y(()=>[h(I,{size:"20"},{default:y(()=>[h(w)]),_:1})]),_:1},8,["onClick","disabled"]),s("h2",X," Inscription "+u(t.curId>0?t.curId:""),1),h(g,{onClick:m.onClickNext,circle:"",type:"primary",class:"nav-btn next-btn",disabled:t.curId==0||t.curId>=t.maxId},{default:y(()=>[h(I,{size:"20"},{default:y(()=>[h(c)]),_:1})]),_:1},8,["onClick","disabled"])])]),s("div",Z,[s("div",$,[t.curInsData.dataType=="text"||t.curInsData.dataType=="deploy-stx10"?(i(),d("div",tt,[s("div",st,[s("pre",et,u(t.curInsData.optInfo.text),1)])])):t.curInsData.dataType.startsWith("image")?(i(),d("div",nt,[s("div",at,[s("img",{src:t.curInsData.optInfo.imageUrl,alt:`Inscription ${t.curInsData.curInscriptionId}`,class:R(["inscription-image",{nn:t.curInsData.optInfo.originImageWidth<=64&&t.curInsData.optInfo.originImageHeight<=64&&t.curInsData.optInfo.originImageWidth>0&&t.curInsData.optInfo.originImageHeight>0}]),width:t.curInsData.optInfo.imageWidth,height:t.kFixImageHeight,onLoad:e[0]||(e[0]=(..._)=>n.handleImageLoad&&n.handleImageLoad(..._)),onError:e[1]||(e[1]=(..._)=>n.handleImageError&&n.handleImageError(..._))},null,42,ot)])])):t.curInsData.dataType.startsWith("audio")?(i(),d("div",it,[s("div",rt,[s("div",ct,u(t.curInsData.optInfo.audioName),1),s("audio",lt,[s("source",{src:t.curInsData.optInfo.audioUrl,type:"audio/mpeg"},null,8,dt),e[2]||(e[2]=v(" Your browser does not support the audio element. "))])])])):D("",!0),t.curInsData.bLoading?(i(),d("div",ut,[h(a,{animated:"",rows:5})])):D("",!0)]),s("div",It,[e[11]||(e[11]=s("h3",{class:"stats-title"},"Inscription Details",-1)),s("div",pt,[t.curInsData.dataType.startsWith("audio")&&t.curInsData.optInfo.audioDesc.length>0?(i(),d("div",ht,[e[3]||(e[3]=s("span",{class:"stat-label"},"Description:",-1)),s("span",mt,u(t.curInsData.optInfo.audioDesc),1)])):D("",!0),s("div",gt,[e[4]||(e[4]=s("span",{class:"stat-label"},"Block:",-1)),s("span",ft,u(t.curInsData.block),1)]),s("div",yt,[e[5]||(e[5]=s("span",{class:"stat-label"},"Content type:",-1)),s("span",_t,u(t.curInsData.dataType),1)]),s("div",Dt,[e[6]||(e[6]=s("span",{class:"stat-label"},"Content length:",-1)),t.curInsData.bLoading?D("",!0):(i(),d("span",bt,u(t.curInsData.dataLength)+" bytes",1))]),s("div",wt,[e[8]||(e[8]=s("span",{class:"stat-label"},"Owner:",-1)),s("div",kt,[!t.curInsData.owner&&!t.curInsData.bLoading?(i(),T(g,{key:0,onClick:m.onClickQueryOwner,size:"small",type:"primary",loading:t.curInsData.bInQueryOwner,class:"query-owner-btn"},{default:y(()=>e[7]||(e[7]=[v(" Query ")])),_:1,__:[7]},8,["onClick","loading"])):(i(),d("a",{key:1,href:"https://explorer.hiro.so/address/"+t.curInsData.owner+"?chain=mainnet",target:"_blank",class:"owner-link"},u(t.curInsData.owner),9,vt))])]),s("div",xt,[e[10]||(e[10]=s("span",{class:"stat-label"},"Mint tx:",-1)),s("div",Ct,[t.curInsData.bLoading?D("",!0):(i(),T(g,{key:0,onClick:m.onClickOpenMintTx,size:"small",type:"primary",loading:t.curInsData.bInQueryMintTx,class:"query-tx-btn"},{default:y(()=>e[9]||(e[9]=[v(" Open ")])),_:1,__:[9]},8,["onClick","loading"]))])])])])]),e[12]||(e[12]=s("div",{class:"detail-animations"},[s("div",{class:"pulsing-circle circle-1"}),s("div",{class:"pulsing-circle circle-2"})],-1))])])}const Ut=W(F,[["render",Lt],["__scopeId","data-v-216b88f0"]]);export{Ut as default};
