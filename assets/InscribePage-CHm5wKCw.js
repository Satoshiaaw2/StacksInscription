import{_ as R,c as h,o as g,a as n,e as l,w as c,g as M,h as X,b,i as q,j as z,d as f,k as P,l as A,n as H,m as W,p as O,q as j,t as C,s as G,u as S,v as Q,x as Y,y,z as J,U as a,A as w,B as p,C as V,D as B,G as _,H as K,I as L,J as Z,K as $,L as ee,M as te,N as ie}from"./index-CMWw0Ui2.js";/* empty css                   *//* empty css                    *//* empty css                    */import{C as ne}from"./ChainHelper-BRDdL9iV.js";window.Buffer=window.Buffer||$.Buffer;const oe=te(),N=ie(),se={name:"InscribePage",components:{},data(){return{bSignedIn:Z.isUserSignedIn(),isInscribing:!1,kMaxBuffLen:1022976,kAudioNameLen:64,kAudioDescLen:64,tips:{kQueryFail:"Query fail, please retry later.",kTickAlreadyExists:"Tick already exists.",kTickNotExists:"Tick doesn't exists yet, need deploy first.",kReceiverIsSelf:"Receiver cann't be equal with current login address!",kTickInvalidAmt:"Invalid amt",kInscribeTransactionTip:"Inscribe transaction has been sent.",kTooMuchFeeTip:"Transaction fee maybe very high, need adjust it manually!"},activeTabName:"text",burnConfig:{default:5e4,deploySTX10:15e6},stx10Info:{tickPlaceholder:"a-z, length from 2 to 16",action:"mint",tick:"",max:"",lim:"",amt:"",receiver:""},imageInfo:{bLoadImageSucceed:!1,fileType:"",fileRaw:null,imageUrl:"",width:1,height:1,originWidth:0,originHeight:0},audioInfo:{bLoadSucceed:!1,fileType:"",fileRaw:null,audioUrl:"",audioName:"",audioDesc:""},needBurnStx:5e4,textarea:"",fileName:"",successDialogVisible:!1,successTx:""}},computed:{inscribeBtnValid(){if(this.activeTabName=="text")return this.textarea.trim().length>0;if(this.activeTabName=="stx10"){if(this.stx10Info.action=="mint")return/^[a-z]{2,16}$/i.test(a.trimLower(this.stx10Info.tick))&&/^[0-9]{1,}$/.test(this.stx10Info.amt.trim())&&parseInt(this.stx10Info.amt.trim())>0;if(this.stx10Info.action=="transfer")return/^[a-z]{2,16}$/i.test(a.trimLower(this.stx10Info.tick))&&/^[0-9]{1,}$/.test(this.stx10Info.amt.trim())&&parseInt(this.stx10Info.amt.trim())>0&&a.parseAddress(this.stx10Info.receiver)!=null;if(this.stx10Info.action=="deploy")return/^[a-z]{2,16}$/i.test(a.trimLower(this.stx10Info.tick))&&/^[0-9]{1,17}$/.test(this.stx10Info.max.trim())&&parseInt(this.stx10Info.max.trim())>0&&/^[0-9]{1,13}$/.test(this.stx10Info.lim.trim())&&parseInt(this.stx10Info.lim.trim())>0}else{if(this.activeTabName=="image")return this.imageInfo.bLoadImageSucceed;if(this.activeTabName=="audio")return this.audioInfo.bLoadSucceed&&this.audioInfo.audioName.trim().length>0}return!1}},async mounted(){},methods:{updateBurnFee(){this.activeTabName!="stx10"?this.needBurnStx=this.burnConfig.default:this.stx10Info.action=="mint"?this.needBurnStx=this.burnConfig.default:this.stx10Info.action=="transfer"?this.needBurnStx=0:this.stx10Info.action=="deploy"&&(this.needBurnStx=this.burnConfig.deploySTX10)},readImageFile(i){if(!i.raw){console.log("readImageFile raw null");return}this.imageInfo.fileRaw=i.raw;let e=this;e.imageInfo.bLoadImageSucceed=!1,w.fromBlob(i.raw).then(o=>{if(!o||!o.mime||!o.mime.startsWith("image/")){console.log("mime invalid"),e.imageInfo.fileType="none";return}e.imageInfo.fileType=o.mime,e.imageInfo.imageUrl=window.URL.createObjectURL(i.raw);var s=new Image;s.src=e.imageInfo.imageUrl,s.onload=function(){e.imageInfo.bLoadImageSucceed=!0;const t=200;e.imageInfo.originWidth=s.width,e.imageInfo.originHeight=s.height,e.imageInfo.width=Math.ceil(s.width*t/s.height),e.imageInfo.height=t}},o=>{a.alert("Error: fromBlob error")})},readImageFileRemove(){this.imageInfo.bLoadImageSucceed=!1,this.imageInfo.imageUrl="",this.imageInfo.fileRaw=null},readImageFileExceed(i){this.$refs.imageUpload.clearFiles();const e=i[0];e.uid=L(),this.$refs.imageUpload.handleStart(e)},readAudioFile(i){let e=this;this.audioInfo.fileRaw=i.raw,e.audioInfo.bLoadSucceed=!1,w.fromBlob(i.raw).then(o=>{if(!o||!o.mime||!o.mime.startsWith("audio/")){e.audioInfo.fileType="none";return}e.audioInfo.fileType=o.mime,e.audioInfo.audioUrl=window.URL.createObjectURL(i.raw),e.audioInfo.bLoadSucceed=!0},o=>{a.alert("Error: fromBlob error")})},readAudioFileRemove(){this.audioInfo.bLoadSucceed=!1,this.audioInfo.audioUrl="",this.audioInfo.fileRaw=null},readAudioFileExceed(i){this.$refs.audioUpload.clearFiles();const e=i[0];e.uid=L(),this.$refs.audioUpload.handleStart(e)},onClickInscribe(){if(!this.bSignedIn){S();return}const i=K.service({lock:!0,background:"rgba(0, 0, 0, 0.6)"});try{this.activeTabName=="text"?this.inscribeText():this.activeTabName=="stx10"?this.inscribeSTX10():this.activeTabName=="image"?this.inscribeImage():this.activeTabName=="audio"&&this.inscribeAudio()}finally{i.close()}},inscribeText(){const i=this.textarea.trim();if(i.length<=0)return;if(i.indexOf('"op":"mint"')!=-1||i.indexOf('"op":"deploy"')!=-1||i.indexOf('"op":"transfer"')!=-1){a.alert("For token operations, please goto the stx10 tab.");return}if(i.length>this.kMaxBuffLen){a.alert(`Max ${this.kMaxBuffLen} bytes(${this.kMaxBuffLen/1024}k), current ${i.length} bytes(${Math.floor(i.length/1024)}k).`);return}let e=this;this.preCheckBalance(this.burnConfig.default,null,function(o){if(!o)return;var s=new TextEncoder().encode(i);const t=[V(s)];e.requestInscribe("inscribe_text",t)})},async inscribeSTX10(){const i=a.trimLower(this.stx10Info.tick);this.stx10Info.tick=i;const e=await B.resolveSTX10InfoByTick(i);if(!e){a.alert(this.tips.kQueryFail);return}if(this.stx10Info.action=="mint"){if(this.stx10Info.tick=="bns"){a.alert("Sorry, bns doesn't support mint due to historic reason.");return}if(e.block==0){a.alert(this.tips.kTickNotExists);return}if(e.supply==e.max){a.alert("Tick has been minted out!");return}const o=BigInt(this.stx10Info.amt),s=e.max-e.supply,t=e.lim<s?e.lim:s;if(o<=0||o>t){t>1?a.alert(`Invalid amt, should from 1 to ${t}`):a.alert("Invalid amt, should be 1");return}let r=this;this.preCheckBalance(this.burnConfig.default,null,function(u){if(!u)return;const m=[p(`{"p":"stx10","op":"mint","tick":"${i}","amt":"${o}"}`),p(i),_(o)];r.requestInscribe("inscribe_mint_stx10",m)})}else if(this.stx10Info.action=="transfer"){if(this.stx10Info.receiver=this.stx10Info.receiver.trim(),e.block==0){a.alert(this.tips.kTickNotExists);return}const o=BigInt(this.stx10Info.amt);if(o<=0){a.alert(this.tips.kTickInvalidAmt);return}const s=await B.loadSTX10Balance(i,y());if(o>s){a.alert(`amt exceeds balance(${s})`);return}if(this.stx10Info.receiver.toLocaleLowerCase()==y().toLocaleLowerCase()){a.alert(this.tips.kReceiverIsSelf);return}const t=a.parseAddress(this.stx10Info.receiver);if(!t){a.alert("Invalid receiver");return}const r=[p(`{"p":"stx10","op":"transfer","tick":"${i}","amt":"${o}"}`),t,p(i),_(o)];this.requestInscribe("inscribe_transfer_stx10",r)}else if(this.stx10Info.action=="deploy"){if(e.block!=0){a.alert(this.tips.kTickAlreadyExists);return}const o=BigInt(this.stx10Info.max);if(o<=0||o>10000000000000000n){a.alert("max should between 1-10000000000000000");return}const s=BigInt(this.stx10Info.lim);if(s<=0){a.alert("Invalid lim");return}if(o/s<20000n){a.alert(`max/lim should >= 20000, currently max(${o})/lim(${s}) is ${o/s}.`);return}let t=this;this.preCheckBalance(this.burnConfig.deploySTX10,null,function(r){if(!r)return;const u=[p(`{"p":"stx10","op":"deploy","tick":"${i}","max":"${o}","lim":"${s}"}`),p(i),_(o),_(s)];t.requestInscribe("inscribe_deploy_stx10",u)})}},async inscribeImage(){if(!this.imageInfo.fileRaw){console.log("inscribeImage fileRaw=nil");return}let i=this;w.fromBlob(this.imageInfo.fileRaw).then(e=>{if(!e||!e.mime){alert("Invalid image");return}const o=new FileReader;o.onload=async function(){var s=new Uint8Array(o.result);if(s.length>1022976){a.alert(`Max 1022976 bytes(999k), current image is ${s.length} bytes(${Math.floor(s.length/1024)}k).`);return}i.preCheckBalance(i.burnConfig.default,"image",function(t){if(!t)return;const r=[p(e.mime),V(s)];i.requestInscribe("inscribe_misc",r)})},o.readAsArrayBuffer(i.imageInfo.fileRaw)},e=>{alert("From fromBlob error")})},async inscribeAudio(){let i=this;w.fromBlob(this.audioInfo.fileRaw).then(e=>{if(!e||!e.mime){alert("Invalid audio");return}const o=new FileReader;o.onload=async function(){var s=new Uint8Array(o.result);if(s.length>1022976-i.kAudioNameLen-i.kAudioDescLen){a.alert(`Max ${1022976/1024}k, current audio file is ${s.length/1024}k.`);return}i.audioInfo.audioName=i.audioInfo.audioName.trim();let t=i.audioInfo.audioName;{var r=new TextEncoder().encode(t);if(r.length>i.kAudioNameLen){a.alert(`Name too long, shall less thant ${i.kAudioNameLen} bytes, currently ${r.length} bytes.`);return}r.length<i.kAudioNameLen&&(t+=" ".repeat(i.kAudioNameLen-r.length))}i.audioInfo.audioDesc=i.audioInfo.audioDesc.trim();let u=i.audioInfo.audioDesc;{var r=new TextEncoder().encode(u);if(r.length>i.kAudioDescLen){a.alert(`Description too long, shall less thant ${i.kAudioDescLen} bytes, currently ${r.length} bytes.`);return}r.length<i.kAudioDescLen&&(u+=" ".repeat(i.kAudioDescLen-r.length))}i.preCheckBalance(i.burnConfig.default,"audio",function(m){if(!m)return;var I=new Uint8Array(s.length+i.kAudioNameLen+i.kAudioDescLen);I.set(s,0);const x=new TextEncoder().encode(t);if(x.length!=i.kAudioNameLen){a.alert("Error: 1001");return}I.set(x,s.length);const k=new TextEncoder().encode(u);if(k.length!=i.kAudioDescLen){a.alert("Error: 1002");return}I.set(k,s.length+i.kAudioNameLen);const v=[p(e.mime),V(I)];i.requestInscribe("inscribe_misc",v)})},o.readAsArrayBuffer(i.audioInfo.fileRaw)},e=>{alert("From fromBlob error")})},async preCheckBalance(i,e,o){const s=await ne.getAccountBalance(y());if(s<i+5e3){a.alert(`Need burn ${i/1e6} STX, balance unenough!`),o(!1);return}let t=null;e=="image"||e=="audio"?(t=`Need burn ${i/1e6} STX, balance is ${s/1e6} STX, make sure fee less than ${(s-i)/1e6} STX!`,s>=5e6&&(t=t+" Double check your fee!")):s<i+1e7&&(t=`Need burn ${i/1e6} STX, balance is ${s/1e6} STX, make sure fee less than ${(s-i)/1e6} STX!`),t?this.$confirm(t,"Attention",{confirmButtonText:"Got it",cancelButtonText:"Cancel",type:"warning"}).then(()=>{o(!0)}).catch(()=>{o(!1)}):o(!0)},async requestInscribe(i,e){let o=[];this.needBurnStx>0&&o.push(Q(y(),Y.LessEqual,this.needBurnStx));let s=this;const t={contractAddress:N.defaultContractAddress,contractName:N.inscriptionsContract.name,functionName:i,functionArgs:e,network:oe,appDetails:ee(),postConditions:o,onFinish:r=>{s.successTx=r.txId,s.successDialogVisible=!0}};J(t)},onClickSignIn(){S()},onClickTest(){}}},le={class:"inscribe-page"},ae={class:"container"},re={class:"tabs-container glass-effect"},de={class:"tab-content"},ue={class:"tab-content"},ce={class:"upload-section"},fe={key:0,class:"image-preview"},me=["src","width","height"],he={class:"tab-content"},ge={class:"operation-forms"},pe={key:0,class:"operation-form"},Ie={class:"form-row"},be={class:"form-row"},xe={key:1,class:"operation-form"},ke={class:"form-row"},ve={class:"form-row"},ye={class:"form-row"},we={key:2,class:"operation-form"},_e={class:"form-row"},Te={class:"form-row"},Ve={class:"form-row"},Ae={class:"tab-content"},Ce={class:"upload-section"},Se={key:0,class:"audio-preview"},Be={controls:"",class:"audio-player"},Le=["src"],Ne={key:1,class:"operation-forms",style:{"margin-top":"12px"}},Ue={class:"operation-form"},Fe={class:"form-row"},Ee={class:"form-row"},De={class:"inscribe-section"},Re={key:0},Me={class:"success-content"},Xe=["href"];function qe(i,e,o,s,t,r){const u=X,m=M,I=A("Upload"),x=P,k=z,v=q,T=O,U=W,F=j,E=A("Edit"),D=G;return g(),h("div",le,[n("div",ae,[e[35]||(e[35]=n("div",{class:"page-header"},[n("h2",{class:"page-title neon-text"},"Inscribe")],-1)),n("div",re,[l(F,{modelValue:t.activeTabName,"onUpdate:modelValue":e[12]||(e[12]=d=>t.activeTabName=d),class:"cyber-tabs",onTabChange:r.updateBurnFee},{default:c(()=>[l(m,{label:"Text",name:"text"},{default:c(()=>[n("div",de,[l(u,{modelValue:t.textarea,"onUpdate:modelValue":e[0]||(e[0]=d=>t.textarea=d),type:"textarea",rows:12,placeholder:"Content",class:"cyber-textarea"},null,8,["modelValue"])])]),_:1}),l(m,{label:"Image",name:"image"},{default:c(()=>[n("div",ue,[n("div",ce,[l(v,{ref:"imageUpload","auto-upload":!1,"show-file-list":!0,limit:1,onChange:r.readImageFile,"on-remove":r.readImageFileRemove,"on-exceed":r.readImageFileExceed,accept:"image/*",class:"cyber-upload"},{default:c(()=>[l(k,{type:"primary",class:"upload-btn"},{default:c(()=>[l(x,null,{default:c(()=>[l(I)]),_:1}),e[14]||(e[14]=f(" Browse File "))]),_:1,__:[14]})]),_:1},8,["onChange","on-remove","on-exceed"]),t.imageInfo.bLoadImageSucceed?(g(),h("div",fe,[n("img",{src:t.imageInfo.imageUrl,width:t.imageInfo.width,height:t.imageInfo.height,class:H({nn:t.imageInfo.originWidth<=64&&t.imageInfo.originHeight<=64&&t.imageInfo.originWidth>0&&t.imageInfo.originHeight>0}),alt:"Preview"},null,10,me)])):b("",!0),e[15]||(e[15]=n("div",{class:"upload-tips"},[n("p",null,[f("Tips: can compress image at "),n("a",{href:"https://tinypng.com",target:"_blank",class:"link"},"tinypng"),f(". ")])],-1))])])]),_:1}),l(m,{label:"stx10",name:"stx10"},{default:c(()=>[n("div",he,[l(U,{modelValue:t.stx10Info.action,"onUpdate:modelValue":e[1]||(e[1]=d=>t.stx10Info.action=d),class:"operation-radios",onChange:r.updateBurnFee},{default:c(()=>[l(T,{label:"mint",size:"large"},{default:c(()=>e[16]||(e[16]=[f("Mint")])),_:1,__:[16]}),l(T,{label:"transfer",size:"large"},{default:c(()=>e[17]||(e[17]=[f("Transfer")])),_:1,__:[17]}),l(T,{label:"deploy",size:"large"},{default:c(()=>e[18]||(e[18]=[f("Deploy")])),_:1,__:[18]})]),_:1},8,["modelValue","onChange"]),n("div",ge,[t.stx10Info.action==="mint"?(g(),h("div",pe,[n("div",Ie,[e[19]||(e[19]=n("label",null,"tick",-1)),l(u,{modelValue:t.stx10Info.tick,"onUpdate:modelValue":e[2]||(e[2]=d=>t.stx10Info.tick=d),placeholder:t.stx10Info.tickPlaceholder,maxlength:"16"},null,8,["modelValue","placeholder"])]),n("div",be,[e[20]||(e[20]=n("label",null,"amt",-1)),l(u,{modelValue:t.stx10Info.amt,"onUpdate:modelValue":e[3]||(e[3]=d=>t.stx10Info.amt=d),placeholder:"Amount"},null,8,["modelValue"])])])):b("",!0),t.stx10Info.action==="transfer"?(g(),h("div",xe,[n("div",ke,[e[21]||(e[21]=n("label",null,"tick",-1)),l(u,{modelValue:t.stx10Info.tick,"onUpdate:modelValue":e[4]||(e[4]=d=>t.stx10Info.tick=d),placeholder:t.stx10Info.tickPlaceholder,maxlength:"16"},null,8,["modelValue","placeholder"])]),n("div",ve,[e[22]||(e[22]=n("label",null,"amt",-1)),l(u,{modelValue:t.stx10Info.amt,"onUpdate:modelValue":e[5]||(e[5]=d=>t.stx10Info.amt=d),placeholder:"Amount"},null,8,["modelValue"])]),n("div",ye,[e[23]||(e[23]=n("label",null,"receiver",-1)),l(u,{modelValue:t.stx10Info.receiver,"onUpdate:modelValue":e[6]||(e[6]=d=>t.stx10Info.receiver=d),placeholder:"Receiver address"},null,8,["modelValue"])])])):b("",!0),t.stx10Info.action==="deploy"?(g(),h("div",we,[n("div",_e,[e[24]||(e[24]=n("label",null,"tick",-1)),l(u,{modelValue:t.stx10Info.tick,"onUpdate:modelValue":e[7]||(e[7]=d=>t.stx10Info.tick=d),placeholder:t.stx10Info.tickPlaceholder,maxlength:"16"},null,8,["modelValue","placeholder"])]),n("div",Te,[e[25]||(e[25]=n("label",null,"max",-1)),l(u,{modelValue:t.stx10Info.max,"onUpdate:modelValue":e[8]||(e[8]=d=>t.stx10Info.max=d),placeholder:"Max supply"},null,8,["modelValue"])]),n("div",Ve,[e[26]||(e[26]=n("label",null,"lim",-1)),l(u,{modelValue:t.stx10Info.lim,"onUpdate:modelValue":e[9]||(e[9]=d=>t.stx10Info.lim=d),placeholder:"Mint limit"},null,8,["modelValue"])])])):b("",!0)])])]),_:1}),l(m,{label:"Audio",name:"audio"},{default:c(()=>[n("div",Ae,[n("div",Ce,[l(v,{ref:"audioUpload","auto-upload":!1,"show-file-list":!0,limit:1,accept:"audio/*",onChange:r.readAudioFile,"on-remove":r.readAudioFileRemove,"on-exceed":r.readAudioFileExceed,class:"cyber-upload"},{default:c(()=>[l(k,{type:"primary",class:"upload-btn"},{default:c(()=>[l(x,null,{default:c(()=>[l(I)]),_:1}),e[27]||(e[27]=f(" Browse Audio File "))]),_:1,__:[27]})]),_:1},8,["onChange","on-remove","on-exceed"]),t.audioInfo.bLoadSucceed?(g(),h("div",Se,[n("audio",Be,[n("source",{src:t.audioInfo.audioUrl,type:"audio/mpeg"},null,8,Le),e[28]||(e[28]=f(" Your browser does not support the audio element. "))])])):b("",!0),t.audioInfo.bLoadSucceed?(g(),h("div",Ne,[n("div",Ue,[n("div",Fe,[e[29]||(e[29]=n("label",null,"Name",-1)),l(u,{modelValue:t.audioInfo.audioName,"onUpdate:modelValue":e[10]||(e[10]=d=>t.audioInfo.audioName=d),placeholder:"Max 64 characters"},null,8,["modelValue"])]),n("div",Ee,[e[30]||(e[30]=n("label",null,"Description",-1)),l(u,{modelValue:t.audioInfo.audioDesc,"onUpdate:modelValue":e[11]||(e[11]=d=>t.audioInfo.audioDesc=d),placeholder:"Max 64 characters"},null,8,["modelValue"])])])])):b("",!0),e[31]||(e[31]=n("div",{class:"upload-tips"},[n("p",null,[f("Tips: can compress audio at "),n("a",{href:"https://www.freeconvert.com",target:"_blank",class:"link"},"FreeConvert"),f(" or "),n("a",{href:"https://www.xconvert.com",target:"_blank",class:"link"},"XConvert"),f(". ")])],-1))])])]),_:1})]),_:1},8,["modelValue","onTabChange"]),n("div",De,[l(k,{onClick:r.onClickInscribe,type:"primary",size:"large",class:"inscribe-btn cyber-glow",disabled:!r.inscribeBtnValid,loading:t.isInscribing},{default:c(()=>[l(x,null,{default:c(()=>[l(E)]),_:1}),e[32]||(e[32]=f(" Inscribe ")),t.needBurnStx>0?(g(),h("span",Re,"("+C(t.needBurnStx/1e6)+" STX)",1)):b("",!0)]),_:1,__:[32]},8,["onClick","disabled","loading"])])]),l(D,{modelValue:t.successDialogVisible,"onUpdate:modelValue":e[13]||(e[13]=d=>t.successDialogVisible=d),title:"Transaction Successful",width:"420px",class:"success-dialog"},{default:c(()=>[n("div",Me,[e[34]||(e[34]=n("p",null,"Your transaction has been submitted successfully!",-1)),n("p",null,[e[33]||(e[33]=f(" View transaction: ")),n("a",{href:`https://explorer.hiro.so/txid/0x${t.successTx}?chain=mainnet`,target:"_blank",class:"tx-link"},"0x"+C(t.successTx.substring(0,5)+"..."+t.successTx.substring(t.successTx.length-4)),9,Xe)])])]),_:1},8,["modelValue"]),e[36]||(e[36]=n("div",{class:"floating-elements"},[n("div",{class:"floating-circle"}),n("div",{class:"floating-square"}),n("div",{class:"floating-triangle"})],-1))])])}const je=R(se,[["render",qe],["__scopeId","data-v-74aaa25a"]]);export{je as default};
