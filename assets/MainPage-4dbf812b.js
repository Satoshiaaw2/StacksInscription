import{_ as T,u as S,g as A,c as U,a as N,h as V,r as y,b as F,o as a,d as i,e,f as I,t as l,i as d,j as w,w as x,k as W,l as B,m as O,n as j,p as H,q as M}from"./index-88f05315.js";import{C as v,c as C}from"./ContractHelper-06a52c12.js";import{U as L}from"./utils-bf7ba3cc.js";import{f as R}from"./browser-ponyfill-76e78561.js";const q=O(),b=j(),z={name:"MainPage",components:{},data(){return{bSignedIn:S.isUserSignedIn(),defaultReadonlyAddress:b.defaultContractAddress,kFixImageHeight:400,bLoadSummaryFinish:!1,curId:1,maxId:10,totalAmount:0,curInsData:{bLoading:!1,curInscriptionId:"",block:0,dataType:"",dataLength:"",payload:"",owner:"",optInfo:{imageUrl:"",imageWidth:"",text:""}}}},computed:{bShowLatest(){return this.bLoadSummaryFinish&&this.curId<this.maxId}},async mounted(){await this.loadSummary(),this.totalAmount>0&&this.showInscription(this.maxId)},methods:{_inGetNetType(){return A()},async loadSummary(){const n=await v.loadSummary();this.totalAmount=parseInt(n.last_token_id),this.curId=this.maxId=Math.max(this.totalAmount,1),this.bLoadSummaryFinish=!0},async onClickChangeInscriptionId(){this.curId>=1&&this.curId<=this.maxId&&this.showInscription(this.curId)},async showInscription(n){this.curId=n;const o=U(N(this.curId));try{this.curInsData.bLoading=!0;const h=await R(`${q.coreApiUrl}/v2/map_entry/${b.defaultContractAddress}/${b.inscriptionsContract.name}/map_inscriptions`,{method:"post",headers:{Accept:"application/json","Content-Type":"application/json"},proof:0,body:JSON.stringify(o)});if(h.status==200){const t=await h.json(),c=V(t.data).value.data,f=Number(C(c.block)),r=C(c.type),p=c.payload.buffer,g=p.length;let s={imageUrl:null,text:null},k=!1;if(r.startsWith("image/")){s.imageUrl=window.URL.createObjectURL(new Blob([p],{type:r})),k=!0;var u=new Image;u.src=s.imageUrl;let D=this;u.onload=function(){D.curInsData.bLoading=!1,D.curInsData.optInfo.imageWidth=Math.ceil(u.width*D.kFixImageHeight/u.height)}}else(r=="text"||r=="deploy-src-20"||r=="sins")&&(s.text=new TextDecoder().decode(c.payload.buffer));k||(this.curInsData.bLoading=!1),this.curInsData.curInscriptionId=n,this.curInsData.block=f,this.curInsData.dataType=r,this.curInsData.dataLength=g,this.curInsData.payload=p,this.curInsData.owner="",this.curInsData.optInfo.imageUrl=s.imageUrl,this.curInsData.optInfo.imageWidth=s.imageWidth,this.curInsData.optInfo.text=s.text}else L.alert(`Request server fail, tokenId=${this.curId}, code=${h.status}, please try again 1 minute later.`)}catch{L.alert(`Request server fail, tokenId=${this.curId}, please try again 1 minute later.`)}finally{this.curInsData.bLoading=!1}},async onClickQueryOwner(){const n=this.curInsData.curInscriptionId,o=await v.queryNFTOwner(n);n==this.curInsData.curInscriptionId&&n==this.curId&&(this.curInsData.owner=o||"")},onClickLatest(){this.showInscription(this.maxId)}}},m=n=>(H("data-v-d7f07990"),n=n(),M(),n),P={id:"main"},Q={id:"title"},E={key:0},G={key:0,id:"searchArea"},J=m(()=>e("span",{id:"id"},"ID:",-1)),K={key:1,id:"inscInfoArea"},X={id:"previewPayload"},Y={key:0},Z={key:1},$=["src","width","height"],tt={key:2},et={id:"briefInfoArea"},nt=m(()=>e("span",null,"Block: ",-1)),st=m(()=>e("span",null,"Content type: ",-1)),at=m(()=>e("span",null,"Content length: ",-1)),ot=m(()=>e("span",null,"Owner: ",-1)),it=["href"],rt={key:2,id:"emptyTip"};function ct(n,o,u,h,t,_){const c=y("el-input-number"),f=y("el-space"),r=y("el-input"),p=y("el-button"),g=F("loading");return a(),i("div",P,[e("div",Q,[I("Total Inscriptions: "),t.bLoadSummaryFinish?(a(),i("span",E,l(t.totalAmount),1)):d("",!0)]),t.bLoadSummaryFinish&&t.totalAmount>0?(a(),i("div",G,[w(f,{size:"large"},{default:x(()=>[J,w(c,{modelValue:t.curId,"onUpdate:modelValue":o[0]||(o[0]=s=>t.curId=s),min:1,max:t.maxId,size:"large",onChange:_.onClickChangeInscriptionId,disabled:t.curInsData.bLoading},null,8,["modelValue","max","onChange","disabled"])]),_:1})])):d("",!0),t.totalAmount>0?W((a(),i("fieldset",K,[e("legend",null,"Inscription #"+l(t.curInsData.curInscriptionId),1),e("div",X,[t.curInsData.dataType=="text"||t.curInsData.dataType=="deploy-src-20"||t.curInsData.dataType=="sins"?(a(),i("div",Y,[w(r,{modelValue:t.curInsData.optInfo.text,"onUpdate:modelValue":o[1]||(o[1]=s=>t.curInsData.optInfo.text=s),readonly:"",type:"textarea",autosize:""},null,8,["modelValue"])])):t.curInsData.dataType.startsWith("image/")?(a(),i("div",Z,[e("img",{src:t.curInsData.optInfo.imageUrl,width:t.curInsData.optInfo.imageWidth,height:t.kFixImageHeight,alt:""},null,8,$)])):(a(),i("div",tt," Not support preview yet. "))]),e("div",et,[e("div",null,[nt,I(l(t.curInsData.block),1)]),e("div",null,[st,I(l(t.curInsData.dataType),1)]),e("div",null,[at,I(l(t.curInsData.dataLength)+" bytes",1)]),e("div",null,[ot,t.curInsData.owner.length>0?(a(),i("a",{key:0,style:{color:"white"},href:"https://explorer.hiro.so/address/"+t.curInsData.owner+"?chain="+_._inGetNetType(),target:"_blank"},l(t.curInsData.owner),9,it)):d("",!0),t.curInsData.owner.length==0?(a(),B(p,{key:1,type:"info",size:"small",onClick:_.onClickQueryOwner},{default:x(()=>[I("Query")]),_:1},8,["onClick"])):d("",!0)])])])),[[g,t.curInsData.bLoading]]):d("",!0),t.bLoadSummaryFinish&&t.totalAmount==0?(a(),i("div",rt,"No inscription yet")):d("",!0)])}const pt=T(z,[["render",ct],["__scopeId","data-v-d7f07990"]]);export{pt as default};
