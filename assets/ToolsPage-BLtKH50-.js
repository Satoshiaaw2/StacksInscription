import{_ as S,c as y,o as f,b as s,d as n,w as r,E as P,a as k,e as W,g as B,h as I,i as z,r as v,L as M,M as Q,Z as j,t as w,S as O,$ as J,l as Y,m as X,U as c,C as Z,s as x,a0 as G,z as N,a1 as K,X as $,a2 as tt,a3 as et,u as at,D as st,p as nt,a4 as ot,I as it,J as lt,a5 as rt,a6 as U,H as dt}from"./index-Cc1XKo18.js";/* empty css                   *//* empty css                    *//* empty css                  *//* empty css                  *//* empty css                        *//* empty css                */import{C as V}from"./ChainHelper-B-epty4G.js";const R=it(),_=lt(),ut={name:"ToolsPage",components:{},data(){return{u:c,kFixImageHeight:128,kAudioNameLen:64,kAudioDescLen:64,defaultReadonlyAddress:_.defaultContractAddress,activeTabName:"holdings",queryHoldingData:{address:"",resolvedAddress:"",nftName:"inscription",state:0,pageLimit:25,total:0,curPage:1,resultCache:{},tableData:[],bInRequestEncounterFail:!1,startLoadAllFlag:0,curInRequestCount:0,kMaxInRequestCount:10,bClickQueryHoldingsFlag:!1},tranInsData:{tokenId:"",address:"",state:0},successDialogVisible:!1,successTx:""}},computed:{queryHoldingsBtnValid(){return this.queryHoldingData.address.trim().length>0},transferInsBtnValid(){return/^[0-9]{1,16}$/.test(this.tranInsData.tokenId.trim())&&this.tranInsData.address.trim().length>0}},async mounted(){},methods:{onClickFillAddress(){this.queryHoldingData.address=x()},async onClickQueryHoldings(){this.queryHoldingData.bClickQueryHoldingsFlag=!0,this.queryHoldingData.state=1;const o=await V.resolveAddress(this.queryHoldingData.address.trim());if(o.ret!=0){this.queryHoldingData.state=0,c.alert(o.errMsg);return}if(!c.parseAddress(o.value)){this.queryHoldingData.state=0,c.alertInvalidAddress();return}this.queryHoldingData.resolvedAddress=o.value,this.queryHoldingPage(1,!0)},async queryHoldingPage(o,e){this.queryHoldingData.state=1;const d=(o-1)*this.queryHoldingData.pageLimit,D=await V.getNFTHoldings(_.defaultContractAddress,_.inscriptionsContract.name,this.queryHoldingData.nftName,this.queryHoldingData.resolvedAddress,this.queryHoldingData.pageLimit,d);this.queryHoldingData.total=D.total,this.queryHoldingData.offset=D.offset,this.queryHoldingData.state=2,this.queryHoldingData.tableData.splice(0,this.queryHoldingData.tableData.length);let t=!1;for(const i of D.results){const u=i.value.repr.substring(1),m=this.queryHoldingData.resultCache[u];m?this.queryHoldingData.tableData.push(m):(t=!0,this.queryHoldingData.tableData.push({id:u,loadingState:0,block:0,dataType:"",dataLength:"",optInfo:{imageUrl:"",imageWidth:"",originImageWidth:0,originImageHeight:0,text:"",audioName:"",audioDesc:"",audioUrl:""}}))}(e||t)&&this.loadAllContent()},onClickChangePage(){this.queryHoldingPage(this.queryHoldingData.curPage)},async loadAllContent(){try{await this.realLoadAllContent()}finally{}},async realLoadAllContent(){this.bInRequestEncounterFail=!1,this.queryHoldingData.startLoadAllFlag++,this.queryHoldingData.curInRequestCount=0;let o=0;for(;!this.bInRequestEncounterFail&&o<this.queryHoldingData.tableData.length;)this.queryHoldingData.curInRequestCount<this.queryHoldingData.kMaxInRequestCount?(this.queryHoldingData.curInRequestCount++,this.loadInscription(this.queryHoldingData.startLoadAllFlag,o,this.queryHoldingData.tableData[o].id),++o):await new Promise(e=>setTimeout(e,1e3))},async loadInscription(o,e,d){const D=ot(N(d));let t=this.queryHoldingData.tableData[e];try{t.loadingState=1;const u=await fetch(`${R.coreApiUrl}/v2/map_entry/${_.defaultContractAddress}/${_.inscriptionsContract.name}/map_inscriptions`,{method:"post",headers:{Accept:"application/json","Content-Type":"application/json"},proof:0,body:JSON.stringify(D)});if(o!=this.queryHoldingData.startLoadAllFlag)return;if(u.status==200){const m=await u.json(),g=rt(m.data).value.data,H=Number(U(g.block)),p=U(g.type),h=g.payload.buffer,T=h.length;let l={imageUrl:null,text:null},C=!1;if(p.startsWith("image/")){l.imageUrl=window.URL.createObjectURL(new Blob([h],{type:p})),C=!0;var i=new Image;i.src=l.imageUrl;let b=this;i.onload=function(){o==b.queryHoldingData.startLoadAllFlag&&(t.loadingState=2,t.optInfo.originImageWidth=i.width,t.optInfo.originImageHeight=i.height,t.optInfo.imageWidth=Math.ceil(i.width*b.kFixImageHeight/i.height))}}else if(p.startsWith("audio/")){const b=h.slice(h.length-this.kAudioNameLen-this.kAudioDescLen,h.length-this.kAudioDescLen);l.audioName=new TextDecoder().decode(b).trim();const A=h.slice(h.length-this.kAudioDescLen);l.audioDesc=new TextDecoder().decode(A).trim();const L=h.slice(0,h.length-this.kAudioNameLen-this.kAudioDescLen);l.audioUrl=window.URL.createObjectURL(new Blob([L],{type:p}))}else(p=="text"||p=="deploy-stx10")&&(l.text=new TextDecoder().decode(g.payload.buffer));C||(t.loadingState=2),t.id=d,t.block=H,t.dataType=p,t.dataLength=T,t.owner="",t.optInfo.imageUrl=l.imageUrl,t.optInfo.imageWidth=l.imageWidth,t.optInfo.originImageWidth=l.originImageWidth,t.optInfo.originImageHeight=l.originImageHeight,t.optInfo.text=l.text,t.optInfo.audioName=l.audioName,t.optInfo.audioDesc=l.audioDesc,t.optInfo.audioUrl=l.audioUrl,this.queryHoldingData.resultCache[d]=t,this.queryHoldingData.curInRequestCount=Math.max(this.queryHoldingData.curInRequestCount-1,0)}else this.bInRequestEncounterFail=!0,c.alert(`Request server fail, tokenId=${d}, code=${u.status}, please try again 1 minute later.`)}catch(u){console.log(`loadInscription fail:${o},tableIndex:${e},id:${d},err:${u}`),this.bInRequestEncounterFail=!0,c.alert(`Request server fail, tokenId=${d}, please try again 1 minute later.`)}finally{t.loadingState=2}},async onClickTransferInscription(){if(!st.isUserSignedIn()){nt();return}this.tranInsData.state=1;try{await this.readyTransferInscription()}finally{this.tranInsData.state=2}},async readyTransferInscription(){const o=this.tranInsData.tokenId.trim(),e=await V.resolveAddress(this.tranInsData.address.trim());if(e.ret!=0){c.alert(e.errMsg);return}if(!c.parseAddress(e.value)){c.alertInvalidAddress();return}const d=await Z.queryNFTOwner(o);if(!d){c.alert(`Inscription #${o} not exist!`);return}if(d.toLowerCase()!=x().toLowerCase()){c.alert(`No permission! Owner of Inscription #${o} is <a href="https://explorer.hiro.so/address/${d}?chain=${G()}" target="_blank">${d}</a>`);return}if(d.toLowerCase()==e.value.toLowerCase()){c.alert("Receiver cann't be equal with current login address!");return}const D=[N(o),K(x()),c.parseAddress(e.value)],t="inscription",i=N(o),u=$(_.defaultContractAddress,_.inscriptionsContract.name,t),m=tt(x(),et.Sends,u,i);let q=this;const g={contractAddress:_.defaultContractAddress,contractName:_.inscriptionsContract.name,functionName:"transfer",functionArgs:D,network:R,appDetails:dt(),postConditions:[m],onFinish:H=>{q.successTx=H.txId,q.successDialogVisible=!0}};at(g)}}},ct={class:"tools-page"},gt={class:"container"},pt={class:"tabs-container glass-effect"},ht={class:"tab-content"},mt={class:"query-form"},yt={class:"form-row"},ft={style:{"text-align":"center"}},_t={key:0,class:"table-section"},Dt={key:0,class:"content-text"},It={key:1,class:"content-text"},bt={key:2,class:"content-image"},qt=["src","alt"],Ht={key:3},Ct={class:"audio-title"},wt={controls:"",class:"audio-player"},kt=["src"],vt={key:4},xt={key:0,class:"pagination-section"},Tt={key:1,class:"empty-state"},At={class:"tab-content"},Lt={class:"transfer-form"},Nt={class:"form-row"},Vt={class:"form-row"},Ut={style:{"text-align":"center"}},Rt={class:"tools-animations"},Ft={class:"floating-tool tool-1"},Et={class:"floating-tool tool-2"},St={class:"success-content"},Pt=["href"];function Wt(o,e,d,D,t,i){const u=W,m=B,q=v("Search"),g=z,H=j,p=Q,h=M,T=O,l=J,C=P,b=v("Right"),A=Y,L=v("Tools"),F=v("Setting"),E=X;return f(),y("div",ct,[s("div",gt,[e[14]||(e[14]=s("div",{class:"page-header"},[s("h2",{class:"page-title neon-text"},"Tools")],-1)),s("div",pt,[n(A,{modelValue:t.activeTabName,"onUpdate:modelValue":e[5]||(e[5]=a=>t.activeTabName=a),class:"cyber-tabs"},{default:r(()=>[n(C,{label:"Query holdings",name:"holdings"},{default:r(()=>[s("div",ht,[s("div",mt,[s("div",yt,[e[8]||(e[8]=s("label",null,"address",-1)),n(u,{modelValue:t.queryHoldingData.address,"onUpdate:modelValue":e[0]||(e[0]=a=>t.queryHoldingData.address=a),placeholder:"Enter wallet address",class:"form-input"},null,8,["modelValue"]),n(m,{onClick:i.onClickFillAddress,type:"info",class:"fill-btn"},{default:r(()=>e[7]||(e[7]=[I(" Fill current account ")])),_:1,__:[7]},8,["onClick"])]),s("div",ft,[n(m,{onClick:i.onClickQueryHoldings,type:"primary",class:"query-btn",loading:t.queryHoldingData.state==1},{default:r(()=>[n(g,null,{default:r(()=>[n(q)]),_:1}),e[9]||(e[9]=I(" Query "))]),_:1,__:[9]},8,["onClick","loading"])])]),t.queryHoldingData.state==2&&t.queryHoldingData.tableData.length>0?(f(),y("div",_t,[n(h,{data:t.queryHoldingData.tableData,class:"cyber-table",style:{width:"100%"},"row-class-name":"table-row"},{default:r(()=>[n(p,{label:"Inscription #",width:"150"},{default:r(a=>[n(H,{href:`#/detail/${a.row.id}`,target:"_blank",type:"primary",class:"inscription-link"},{default:r(()=>[I(" #"+w(a.row.id),1)]),_:2},1032,["href"])]),_:1}),n(p,{label:"Content","min-width":"300"},{default:r(a=>[a.row.loadingState==1?(f(),y("div",Dt," Loading.. ")):k("",!0),a.row.loadingState==2&&(a.row.dataType=="text"||a.row.dataType=="deploy-stx10")?(f(),y("div",It,w(a.row.optInfo.text.length>100?a.row.optInfo.text.substring(0,100)+"..":a.row.optInfo.text),1)):a.row.loadingState==2&&a.row.dataType.startsWith("image/")?(f(),y("div",bt,[s("img",{src:a.row.optInfo.imageUrl,alt:`Inscription ${a.row.inscriptionId}`},null,8,qt)])):a.row.loadingState==2&&a.row.dataType.startsWith("audio/")?(f(),y("div",Ht,[s("div",Ct,w(a.row.optInfo.audioName),1),s("audio",wt,[s("source",{src:a.row.optInfo.audioUrl,type:"audio/mpeg"},null,8,kt),e[10]||(e[10]=I(" Your browser does not support the audio element. "))])])):a.row.loadingState==2?(f(),y("div",vt," Not support preview. ")):k("",!0)]),_:1}),n(p,{label:"Content type",width:"150",style:{"text-align":"center"}},{default:r(a=>[I(w(a.row.dataType),1)]),_:1})]),_:1},8,["data"]),t.queryHoldingData.state==2&&t.queryHoldingData.total>t.queryHoldingData.pageLimit?(f(),y("div",xt,[n(T,{"current-page":t.queryHoldingData.curPage,"onUpdate:currentPage":e[1]||(e[1]=a=>t.queryHoldingData.curPage=a),"page-size":t.queryHoldingData.pageLimit,"onUpdate:pageSize":e[2]||(e[2]=a=>t.queryHoldingData.pageLimit=a),total:t.queryHoldingData.total,layout:"prev, pager, next, total",class:"cyber-pagination",onCurrentChange:i.onClickChangePage},null,8,["current-page","page-size","total","onCurrentChange"])])):k("",!0)])):t.queryHoldingData.state==2&&t.queryHoldingData.total===0?(f(),y("div",Tt,[n(l,{"image-size":200,description:"No inscriptions found",class:"cyber-empty"})])):k("",!0)])]),_:1}),n(C,{label:"Transfer inscription",name:"transfer"},{default:r(()=>[s("div",At,[s("div",Lt,[s("div",Nt,[e[11]||(e[11]=s("label",null,"inscription id",-1)),n(u,{modelValue:t.tranInsData.tokenId,"onUpdate:modelValue":e[3]||(e[3]=a=>t.tranInsData.tokenId=a),placeholder:"Enter inscription ID",class:"form-input"},null,8,["modelValue"])]),s("div",Vt,[e[12]||(e[12]=s("label",null,"address",-1)),n(u,{modelValue:t.tranInsData.address,"onUpdate:modelValue":e[4]||(e[4]=a=>t.tranInsData.address=a),placeholder:"Enter recipient address",class:"form-input"},null,8,["modelValue"])]),s("div",Ut,[n(m,{onClick:i.onClickTransferInscription,type:"primary",class:"transfer-btn",loading:t.tranInsData.state==1,disabled:!i.transferInsBtnValid},{default:r(()=>[n(g,null,{default:r(()=>[n(b)]),_:1}),e[13]||(e[13]=I(" Transfer "))]),_:1,__:[13]},8,["onClick","loading","disabled"])])])])]),_:1})]),_:1},8,["modelValue"])]),s("div",Rt,[s("div",Ft,[n(g,{size:"40"},{default:r(()=>[n(L)]),_:1})]),s("div",Et,[n(g,{size:"40"},{default:r(()=>[n(F)]),_:1})])])]),n(E,{modelValue:t.successDialogVisible,"onUpdate:modelValue":e[6]||(e[6]=a=>t.successDialogVisible=a),title:"Transaction Successful",width:"420px",class:"success-dialog"},{default:r(()=>[s("div",St,[e[16]||(e[16]=s("p",null,"Your transaction has been submitted successfully!",-1)),s("p",null,[e[15]||(e[15]=I(" View transaction: ")),s("a",{href:`https://explorer.hiro.so/txid/0x${t.successTx}?chain=mainnet`,target:"_blank",class:"tx-link"},"0x"+w(t.successTx.substring(0,5)+"..."+t.successTx.substring(t.successTx.length-4)),9,Pt)])])]),_:1},8,["modelValue"])])}const Xt=S(ut,[["render",Wt],["__scopeId","data-v-014d3da1"]]);export{Xt as default};
